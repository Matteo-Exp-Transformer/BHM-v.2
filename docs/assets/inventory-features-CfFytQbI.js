import{a as G,u as L,b as z,j as e}from"./query-vendor-yChzfXyf.js";import{r as f}from"./react-vendor-C-olevxG.js";import{u as Y,s as N,C as $,a as ve}from"./calendar-features-C85Z3oOU.js";import{B as j,E as Ne,S as _e,T as ee,l as K,M as we,f as O,m as M,e as T,b as B,n as te,d as H,X as W,o as Se,a as Ee,D as Ce,k as re,p as ae,g as X,q as qe,F as Pe,r as De}from"./ui-vendor-Cbmmx1ZO.js";var C=(t=>(t.GLUTINE="glutine",t.LATTE="latte",t.UOVA="uova",t.SOIA="soia",t.FRUTTA_GUSCIO="frutta_guscio",t.ARACHIDI="arachidi",t.PESCE="pesce",t.CROSTACEI="crostacei",t))(C||{}),D=(t=>(t.AMBIENT="ambient",t.FRIDGE="fridge",t.FREEZER="freezer",t.BLAST="blast",t))(D||{});const Q={categories:t=>["productCategories",t],category:t=>["productCategory",t]},ke=()=>{const{user:t,companyId:o}=Y(),c=G(),{data:a=[],isLoading:m,error:s,refetch:l}=L({queryKey:Q.categories(o||""),queryFn:async()=>{if(!o)return[];const{data:i,error:y}=await N.from("product_categories").select("*").eq("company_id",o).order("name");if(y)throw console.error("Error fetching categories:",y),y;return i},enabled:!!o&&!!t}),d=z({mutationFn:async i=>{const{data:y,error:n}=await N.from("product_categories").insert({...i,company_id:o}).select().single();if(n)throw console.error("Error creating category:",n),n;return y},onSuccess:()=>{c.invalidateQueries({queryKey:Q.categories(o||"")}),j.success("Categoria creata con successo")},onError:i=>{console.error("Error creating category:",i),j.error("Errore nella creazione della categoria")}}),g=z({mutationFn:async({id:i,...y})=>{const{data:n,error:b}=await N.from("product_categories").update({...y,updated_at:new Date().toISOString()}).eq("id",i).eq("company_id",o).select().single();if(b)throw console.error("Error updating category:",b),b;return n},onSuccess:()=>{c.invalidateQueries({queryKey:Q.categories(o||"")}),j.success("Categoria aggiornata con successo")},onError:i=>{console.error("Error updating category:",i),j.error("Errore nell'aggiornamento della categoria")}}),p=z({mutationFn:async i=>{const{data:y}=await N.from("products").select("id").eq("category_id",i).eq("company_id",o).limit(1);if(y&&y.length>0)throw new Error("Impossibile eliminare la categoria: è utilizzata da alcuni prodotti");const{error:n}=await N.from("product_categories").delete().eq("id",i).eq("company_id",o);if(n)throw console.error("Error deleting category:",n),n},onSuccess:()=>{c.invalidateQueries({queryKey:Q.categories(o||"")}),j.success("Categoria eliminata con successo")},onError:i=>{console.error("Error deleting category:",i),j.error(i.message||"Errore nell'eliminazione della categoria")}});return{categories:a,isLoading:m,error:s,createCategory:d.mutate,updateCategory:g.mutate,deleteCategory:p.mutate,isCreating:d.isPending,isUpdating:g.isPending,isDeleting:p.isPending,refetch:l}},A={expiryAlerts:(t,o)=>["expiryAlerts",t,o],expiredProducts:t=>["expiredProducts",t],expiryStats:t=>["expiryStats",t]},Ae=(t=7)=>{const{user:o,companyId:c}=Y(),a=G(),{data:m=[],isLoading:s,error:l,refetch:d}=L({queryKey:A.expiryAlerts(c||"",t),queryFn:async()=>(console.log("🔧 Using mock data for expiry alerts - database disabled temporarily"),[{product_id:"1",product_name:"Latte Fresco Intero",expiry_date:new Date("2025-09-28"),days_until_expiry:7,alert_level:"warning"}]),enabled:!!c&&!!o}),{data:g=[],isLoading:p,error:i,refetch:y}=L({queryKey:A.expiredProducts(c||""),queryFn:async()=>(console.log("🔧 Using mock data for expired products - database disabled temporarily"),[{id:"3",company_id:"company1",name:"Latte Scaduto",category_id:"cat1",department_id:"dept1",quantity:1,unit:"litri",expiry_date:new Date("2025-09-19"),status:"expired",compliance_status:"non_compliant",allergens:[],label_photo_url:void 0,notes:"Prodotto scaduto",temperature_requirements:{min_temp:0,max_temp:4,storage_type:"fridge"},expired_at:new Date("2025-09-19"),reinsertion_count:0,created_at:new Date,updated_at:new Date}]),enabled:!!c&&!!o}),{data:n}=L({queryKey:A.expiryStats(c||""),queryFn:async()=>(console.log("🔧 Using mock data for expiry stats - database disabled temporarily"),{total_expiring:1,expiring_today:0,expiring_this_week:1,expired_count:1,by_alert_level:{critical:0,warning:1,expired:1}}),enabled:!!c&&!!o}),b=z({mutationFn:async u=>{console.log("🔧 Mock: marking product as expired - database disabled temporarily",u)},onSuccess:()=>{a.invalidateQueries({queryKey:A.expiryAlerts(c||"")}),a.invalidateQueries({queryKey:A.expiredProducts(c||"")}),a.invalidateQueries({queryKey:A.expiryStats(c||"")}),j.success("Prodotto marcato come scaduto")},onError:u=>{console.error("Error marking product as expired:",u),j.error("Errore nel marcare il prodotto come scaduto")}}),r=z({mutationFn:async u=>{const{data:h,error:q}=await N.from("products").select("*").eq("id",u.expired_product_id).eq("company_id",c).single();if(q)throw console.error("Error fetching expired product:",q),q;const{error:P}=await N.from("products").insert({...h,id:void 0,expiry_date:u.new_expiry_date.toISOString().split("T")[0],quantity:u.new_quantity||h.quantity,status:"active",notes:u.notes||h.notes,created_at:new Date().toISOString(),updated_at:new Date().toISOString()});if(P)throw console.error("Error reinserting expired product:",P),P;const{error:_}=await N.from("products").update({status:"consumed",updated_at:new Date().toISOString()}).eq("id",u.expired_product_id).eq("company_id",c);if(_)throw console.error("Error updating original product status:",_),_},onSuccess:()=>{a.invalidateQueries({queryKey:A.expiredProducts(c||"")}),a.invalidateQueries({queryKey:A.expiryStats(c||"")}),j.success("Prodotto reinserito con successo")},onError:u=>{console.error("Error reinserting expired product:",u),j.error("Errore nel reinserimento del prodotto")}});return{expiryAlerts:m,expiredProducts:g,expiryStats:n,isLoading:s||p,error:l||i,markAsExpired:b.mutate,reinsertExpiredProduct:r.mutate,isMarkingAsExpired:b.isPending,isReinserting:r.isPending,refetch:()=>{d(),y()}}},I={expiredProducts:t=>["expiredProducts",t],wasteStats:t=>["wasteStats",t]},Ie=()=>{const{user:t}=Y(),o=G(),{data:c=[],isLoading:a,error:m,refetch:s}=L({queryKey:I.expiredProducts(t?.company_id||""),queryFn:async()=>(console.log("🔧 Using mock data for expired products - database disabled temporarily"),[{id:"3",company_id:t?.company_id||"",name:"Latte Scaduto",category_id:"cat1",category_name:"Latticini",department_id:"dept1",department_name:"Cucina",conservation_point_id:"cp1",conservation_point_name:"Frigorifero Principale",barcode:"1234567890123",supplier_name:"Latteria Centrale",purchase_date:new Date("2025-09-01"),expiry_date:new Date("2025-09-19"),quantity:1,unit:"litri",allergens:[C.LATTE],temperature_requirements:{min_temp:0,max_temp:4,storage_type:"fridge"},label_photo_url:void 0,status:"expired",notes:"Prodotto scaduto da rimuovere",expired_at:new Date("2025-09-19"),compliance_status:"non_compliant",reinsertion_count:0,created_at:new Date("2025-09-01"),updated_at:new Date}]),enabled:!!t?.company_id}),{data:l,isLoading:d,error:g}=L({queryKey:I.wasteStats(t?.company_id||""),queryFn:async()=>{if(!t?.company_id)return{total_expired_products:0,total_waste_cost:0,average_expiry_days:0,most_wasted_category:"",waste_trend:"stable",monthly_waste_cost:[],prevention_savings:0};console.log("🔧 Using mock data for waste stats - database disabled temporarily");const n=[{id:"3",name:"Latte Scaduto",quantity:1,expiry_date:"2025-09-19",product_categories:{name:"Latticini"}}],b=n.length,r=n.reduce((v,w)=>v+w.quantity*2.5,0),u=new Date,h=n.reduce((v,w)=>{const S=new Date(w.expiry_date),E=u.getTime()-S.getTime(),k=Math.ceil(E/(1e3*60*60*24));return v+k},0),q=b>0?h/b:0,P=n.reduce((v,w)=>{const S=w.product_categories.name;return v[S]=(v[S]||0)+1,v},{}),_=Object.entries(P).reduce((v,[w,S])=>S>v.count?{category:w,count:S}:v,{category:"",count:0}).category;return{total_expired_products:b,total_waste_cost:r,average_expiry_days:Math.round(q),most_wasted_category:_,waste_trend:"stable",monthly_waste_cost:[],prevention_savings:r*.3}},enabled:!!t?.company_id}),p=z({mutationFn:async({expiredProductId:n,newExpiryDate:b,newQuantity:r,notes:u})=>{if(!t?.company_id)throw new Error("User not authenticated");const{data:h,error:q}=await N.from("products").select("*").eq("id",n).eq("company_id",t.company_id).single();if(q||!h)throw new Error("Product not found");const P={...h,id:crypto.randomUUID(),expiry_date:b.toISOString(),quantity:r||h.quantity,status:"active",previous_product_id:n,reinsertion_count:(h.reinsertion_count||0)+1,notes:u||h.notes,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{error:_}=await N.from("products").insert(P);if(_)throw _;const{error:v}=await N.from("products").update({status:"archived",archived_at:new Date().toISOString()}).eq("id",n);if(v)throw v;return{success:!0}},onSuccess:()=>{j.success("Prodotto reinserito con successo"),o.invalidateQueries({queryKey:I.expiredProducts(t?.company_id||"")}),o.invalidateQueries({queryKey:I.wasteStats(t?.company_id||"")}),o.invalidateQueries({queryKey:["products",t?.company_id]})},onError:n=>{console.error("Error reinserting product:",n),j.error("Errore nel reinserimento del prodotto")}}),i=z({mutationFn:async n=>{if(!t?.company_id)throw new Error("User not authenticated");const{error:b}=await N.from("products").delete().eq("id",n).eq("company_id",t.company_id);if(b)throw b;return{success:!0}},onSuccess:()=>{j.success("Prodotto eliminato definitivamente"),o.invalidateQueries({queryKey:I.expiredProducts(t?.company_id||"")}),o.invalidateQueries({queryKey:I.wasteStats(t?.company_id||"")})},onError:n=>{console.error("Error deleting expired product:",n),j.error("Errore nell'eliminazione del prodotto")}}),y=z({mutationFn:async n=>{if(!t?.company_id)throw new Error("User not authenticated");const{error:b}=await N.from("products").delete().in("id",n).eq("company_id",t.company_id);if(b)throw b;return{success:!0,deletedCount:n.length}},onSuccess:n=>{j.success(`${n.deletedCount} prodotti eliminati definitivamente`),o.invalidateQueries({queryKey:I.expiredProducts(t?.company_id||"")}),o.invalidateQueries({queryKey:I.wasteStats(t?.company_id||"")})},onError:n=>{console.error("Error bulk deleting expired products:",n),j.error("Errore nell'eliminazione dei prodotti")}});return{expiredProducts:c,wasteStats:l,isLoadingExpired:a,isLoadingWasteStats:d,expiredError:m,wasteStatsError:g,reinsertExpiredProduct:p,deleteExpiredProduct:i,bulkDeleteExpired:y,refetchExpired:s,isReinserting:p.isPending,isDeleting:i.isPending,isBulkDeleting:y.isPending}};function ze({product:t,onEdit:o,onDelete:c,onStatusChange:a}){const[m,s]=f.useState(!1),l=i=>{switch(i){case"active":return"bg-green-100 text-green-800";case"expired":return"bg-red-100 text-red-800";case"consumed":return"bg-gray-100 text-gray-800";case"waste":return"bg-orange-100 text-orange-800";default:return"bg-gray-100 text-gray-800"}},d=i=>{switch(i){case"active":return e.jsx(H,{className:"w-4 h-4"});case"expired":return e.jsx(T,{className:"w-4 h-4"});case"consumed":return e.jsx(H,{className:"w-4 h-4"});case"waste":return e.jsx(te,{className:"w-4 h-4"});default:return e.jsx(M,{className:"w-4 h-4"})}},p=(()=>{if(!t.expiry_date)return null;const i=new Date(t.expiry_date),y=new Date,n=Math.ceil((i.getTime()-y.getTime())/(1e3*60*60*24));return n<0?{text:"Scaduto",color:"text-red-600",icon:e.jsx(T,{className:"w-4 h-4"})}:n<=2?{text:`Scade tra ${n} giorni`,color:"text-orange-600",icon:e.jsx(B,{className:"w-4 h-4"})}:n<=7?{text:`Scade tra ${n} giorni`,color:"text-yellow-600",icon:e.jsx(B,{className:"w-4 h-4"})}:null})();return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-medium text-gray-900 truncate",children:t.name}),t.sku&&e.jsxs("p",{className:"text-sm text-gray-500",children:["SKU: ",t.sku]})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-2",children:[e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${l(t.status)}`,children:[d(t.status),t.status]}),e.jsx("button",{onClick:()=>s(!m),className:"p-1 text-gray-400 hover:text-gray-600",children:e.jsx(Ne,{className:"w-4 h-4"})})]})]}),m&&e.jsx("div",{className:"absolute right-2 top-12 bg-white border border-gray-200 rounded-lg shadow-lg z-10",children:e.jsxs("div",{className:"py-1",children:[e.jsxs("button",{onClick:()=>{s(!1),o()},className:"flex items-center gap-2 w-full px-3 py-2 text-sm text-gray-700 hover:bg-gray-100",children:[e.jsx(_e,{className:"w-4 h-4"}),"Modifica"]}),e.jsxs("button",{onClick:()=>{s(!1),c()},className:"flex items-center gap-2 w-full px-3 py-2 text-sm text-red-600 hover:bg-red-50",children:[e.jsx(ee,{className:"w-4 h-4"}),"Elimina"]})]})}),e.jsxs("div",{className:"space-y-2 mb-3",children:[t.category_id&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(K,{className:"w-4 h-4"}),e.jsxs("span",{children:["Categoria: ",t.category_id]})]}),t.department_id&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(we,{className:"w-4 h-4"}),e.jsxs("span",{children:["Reparto: ",t.department_id]})]}),t.expiry_date&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(O,{className:"w-4 h-4"}),e.jsxs("span",{children:["Scadenza:"," ",new Date(t.expiry_date).toLocaleDateString("it-IT")]})]}),t.quantity&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(M,{className:"w-4 h-4"}),e.jsxs("span",{children:["Quantità: ",t.quantity," ",t.unit||"pz"]})]}),t.supplier_name&&e.jsx("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:e.jsxs("span",{children:["Fornitore: ",t.supplier_name]})})]}),p&&e.jsxs("div",{className:`flex items-center gap-2 p-2 rounded-lg mb-3 ${p.color.includes("red")?"bg-red-50":p.color.includes("orange")?"bg-orange-50":"bg-yellow-50"}`,children:[p.icon,e.jsx("span",{className:`text-sm font-medium ${p.color}`,children:p.text})]}),t.allergens&&t.allergens.length>0&&e.jsx("div",{className:"mb-3",children:e.jsx("div",{className:"flex flex-wrap gap-1",children:t.allergens.map(i=>e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800",children:i},i))})}),t.notes&&e.jsx("div",{className:"mb-3",children:e.jsx("p",{className:"text-sm text-gray-600 line-clamp-2",children:t.notes})}),t.status==="active"&&e.jsxs("div",{className:"flex gap-2 pt-3 border-t border-gray-100",children:[e.jsx("button",{onClick:()=>a("consumed"),className:"flex-1 px-3 py-2 bg-green-100 text-green-700 rounded-lg hover:bg-green-200 transition-colors text-sm font-medium",children:"Marca come Consumato"}),e.jsx("button",{onClick:()=>a("expired"),className:"flex-1 px-3 py-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors text-sm font-medium",children:"Marca come Scaduto"})]}),t.status==="expired"&&e.jsx("div",{className:"flex gap-2 pt-3 border-t border-gray-100",children:e.jsx("button",{onClick:()=>a("waste"),className:"flex-1 px-3 py-2 bg-orange-100 text-orange-700 rounded-lg hover:bg-orange-200 transition-colors text-sm font-medium",children:"Marca come Rifiuto"})})]})}const Te=[{value:C.GLUTINE,label:"Glutine"},{value:C.LATTE,label:"Latte"},{value:C.UOVA,label:"Uova"},{value:C.SOIA,label:"Soia"},{value:C.FRUTTA_GUSCIO,label:"Frutta a guscio"},{value:C.ARACHIDI,label:"Arachidi"},{value:C.PESCE,label:"Pesce"},{value:C.CROSTACEI,label:"Crostacei"}],Me=[{value:"pz",label:"Pezzi"},{value:"kg",label:"Chilogrammi"},{value:"g",label:"Grammi"},{value:"l",label:"Litri"},{value:"ml",label:"Millilitri"},{value:"scatola",label:"Scatola"},{value:"confezione",label:"Confezione"},{value:"bottiglia",label:"Bottiglia"}];function Z({isOpen:t,onClose:o,onSubmit:c,product:a,categories:m,isLoading:s}){const[l,d]=f.useState({name:"",category_id:"",department_id:"",conservation_point_id:"",barcode:"",sku:"",supplier_name:"",purchase_date:void 0,expiry_date:void 0,quantity:void 0,unit:"pz",allergens:[],label_photo_url:"",notes:""}),[g,p]=f.useState({});f.useEffect(()=>{d(a?{name:a.name,category_id:a.category_id||"",department_id:a.department_id||"",conservation_point_id:a.conservation_point_id||"",barcode:a.barcode||"",sku:a.sku||"",supplier_name:a.supplier_name||"",purchase_date:a.purchase_date?new Date(a.purchase_date):void 0,expiry_date:a.expiry_date?new Date(a.expiry_date):void 0,quantity:a.quantity||void 0,unit:a.unit||"pz",allergens:a.allergens||[],label_photo_url:a.label_photo_url||"",notes:a.notes||""}:{name:"",category_id:"",department_id:"",conservation_point_id:"",barcode:"",sku:"",supplier_name:"",purchase_date:void 0,expiry_date:void 0,quantity:void 0,unit:"pz",allergens:[],label_photo_url:"",notes:""}),p({})},[a,t]);const i=(r,u)=>{d(h=>({...h,[r]:u})),g[r]&&p(h=>({...h,[r]:""}))},y=r=>{d(u=>({...u,allergens:u.allergens.includes(r)?u.allergens.filter(h=>h!==r):[...u.allergens,r]}))},n=()=>{const r={};return l.name.trim()||(r.name="Il nome del prodotto è obbligatorio"),l.expiry_date&&l.purchase_date&&l.expiry_date<=l.purchase_date&&(r.expiry_date="La data di scadenza deve essere successiva alla data di acquisto"),l.quantity&&l.quantity<=0&&(r.quantity="La quantità deve essere maggiore di zero"),p(r),Object.keys(r).length===0},b=r=>{r.preventDefault(),n()&&c(l)};return t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(M,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:a?"Modifica Prodotto":"Nuovo Prodotto"}),e.jsx("p",{className:"text-sm text-gray-600",children:a?"Aggiorna le informazioni del prodotto":"Aggiungi un nuovo prodotto all'inventario"})]})]}),e.jsx("button",{onClick:o,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(W,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:b,className:"p-6 space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 flex items-center gap-2",children:[e.jsx(M,{className:"w-5 h-5"}),"Informazioni Base"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome Prodotto *"}),e.jsx("input",{type:"text",value:l.name,onChange:r=>i("name",r.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${g.name?"border-red-300":"border-gray-300"}`,placeholder:"Es. Pomodori San Marzano"}),g.name&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:g.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"SKU"}),e.jsx("input",{type:"text",value:l.sku,onChange:r=>i("sku",r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Es. PMT-SM-001"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Codice a Barre"}),e.jsx("input",{type:"text",value:l.barcode,onChange:r=>i("barcode",r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Es. 1234567890123"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Fornitore"}),e.jsx("input",{type:"text",value:l.supplier_name,onChange:r=>i("supplier_name",r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Es. Fornitore ABC"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 flex items-center gap-2",children:[e.jsx(K,{className:"w-5 h-5"}),"Categoria e Posizione"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Categoria"}),e.jsxs("select",{value:l.category_id,onChange:r=>i("category_id",r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Seleziona categoria"}),m.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Reparto"}),e.jsxs("select",{value:l.department_id,onChange:r=>i("department_id",r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Seleziona reparto"}),e.jsx("option",{value:"cucina",children:"Cucina"}),e.jsx("option",{value:"bancone",children:"Bancone"}),e.jsx("option",{value:"sala",children:"Sala"}),e.jsx("option",{value:"magazzino",children:"Magazzino"})]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 flex items-center gap-2",children:[e.jsx(O,{className:"w-5 h-5"}),"Date e Quantità"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data Acquisto"}),e.jsx("input",{type:"date",value:l.purchase_date?l.purchase_date.toISOString().split("T")[0]:"",onChange:r=>i("purchase_date",r.target.value?new Date(r.target.value):void 0),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data Scadenza"}),e.jsx("input",{type:"date",value:l.expiry_date?l.expiry_date.toISOString().split("T")[0]:"",onChange:r=>i("expiry_date",r.target.value?new Date(r.target.value):void 0),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${g.expiry_date?"border-red-300":"border-gray-300"}`}),g.expiry_date&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:g.expiry_date})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Quantità"}),e.jsx("input",{type:"number",min:"0",step:"0.1",value:l.quantity||"",onChange:r=>i("quantity",r.target.value?parseFloat(r.target.value):void 0),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${g.quantity?"border-red-300":"border-gray-300"}`,placeholder:"Es. 5"}),g.quantity&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:g.quantity})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Unità di Misura"}),e.jsx("select",{value:l.unit,onChange:r=>i("unit",r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:Me.map(r=>e.jsx("option",{value:r.value,children:r.label},r.value))})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 flex items-center gap-2",children:[e.jsx(T,{className:"w-5 h-5"}),"Allergeni"]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:Te.map(r=>e.jsxs("label",{className:"flex items-center gap-2 p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:l.allergens.includes(r.value),onChange:()=>y(r.value),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:r.label})]},r.value))})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Note"}),e.jsx("textarea",{value:l.notes,onChange:r=>i("notes",r.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Note aggiuntive sul prodotto..."})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-6 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:o,className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",children:"Annulla"}),e.jsxs("button",{type:"submit",disabled:s,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center gap-2",children:[s&&e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),a?"Aggiorna":"Crea"," Prodotto"]})]})]})]})}):null}const Le=[{value:D.AMBIENT,label:"Ambiente"},{value:D.FRIDGE,label:"Frigorifero"},{value:D.FREEZER,label:"Freezer"},{value:D.BLAST,label:"Abbattitore"}],Fe=["glutine","latte","uova","soia","frutta_guscio","arachidi","pesce","crostacei"];function J({isOpen:t,onClose:o,onSubmit:c,category:a,isLoading:m}){const[s,l]=f.useState({name:"",description:"",temperature_requirements:{min_temp:0,max_temp:25,storage_type:D.AMBIENT},default_expiry_days:void 0,allergen_info:[]}),[d,g]=f.useState({});f.useEffect(()=>{l(a?{name:a.name,description:a.description||"",temperature_requirements:a.temperature_requirements||{min_temp:0,max_temp:25,storage_type:D.AMBIENT},default_expiry_days:a.default_expiry_days||void 0,allergen_info:a.allergen_info||[]}:{name:"",description:"",temperature_requirements:{min_temp:0,max_temp:25,storage_type:D.AMBIENT},default_expiry_days:void 0,allergen_info:[]}),g({})},[a,t]);const p=(r,u)=>{l(h=>({...h,[r]:u})),d[r]&&g(h=>({...h,[r]:""}))},i=(r,u)=>{l(h=>({...h,temperature_requirements:{...h.temperature_requirements,[r]:u}}))},y=r=>{l(u=>({...u,allergen_info:u.allergen_info.includes(r)?u.allergen_info.filter(h=>h!==r):[...u.allergen_info,r]}))},n=()=>{const r={};return s.name.trim()||(r.name="Il nome della categoria è obbligatorio"),s.temperature_requirements&&s.temperature_requirements.min_temp>=s.temperature_requirements.max_temp&&(r.temperature="La temperatura minima deve essere inferiore alla massima"),s.default_expiry_days&&s.default_expiry_days<=0&&(r.default_expiry_days="I giorni di scadenza devono essere maggiori di zero"),g(r),Object.keys(r).length===0},b=r=>{r.preventDefault(),n()&&c(s)};return t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(K,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:a?"Modifica Categoria":"Nuova Categoria"}),e.jsx("p",{className:"text-sm text-gray-600",children:a?"Aggiorna le informazioni della categoria":"Crea una nuova categoria di prodotti"})]})]}),e.jsx("button",{onClick:o,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(W,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:b,className:"p-6 space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 flex items-center gap-2",children:[e.jsx(K,{className:"w-5 h-5"}),"Informazioni Base"]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome Categoria *"}),e.jsx("input",{type:"text",value:s.name,onChange:r=>p("name",r.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent ${d.name?"border-red-300":"border-gray-300"}`,placeholder:"Es. Verdura Fresca"}),d.name&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:d.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descrizione"}),e.jsx("textarea",{value:s.description,onChange:r=>p("description",r.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:"Descrizione della categoria..."})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 flex items-center gap-2",children:[e.jsx(Se,{className:"w-5 h-5"}),"Requisiti di Temperatura"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo di Conservazione"}),e.jsx("select",{value:s.temperature_requirements?.storage_type||D.AMBIENT,onChange:r=>i("storage_type",r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",children:Le.map(r=>e.jsx("option",{value:r.value,children:r.label},r.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Temperatura Minima (°C)"}),e.jsx("input",{type:"number",value:s.temperature_requirements?.min_temp||0,onChange:r=>i("min_temp",parseFloat(r.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",step:"0.1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Temperatura Massima (°C)"}),e.jsx("input",{type:"number",value:s.temperature_requirements?.max_temp||25,onChange:r=>i("max_temp",parseFloat(r.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",step:"0.1"})]})]}),d.temperature&&e.jsx("p",{className:"text-sm text-red-600",children:d.temperature})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 flex items-center gap-2",children:[e.jsx(O,{className:"w-5 h-5"}),"Impostazioni Scadenza"]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Giorni di Scadenza Predefiniti"}),e.jsx("input",{type:"number",min:"1",value:s.default_expiry_days||"",onChange:r=>p("default_expiry_days",r.target.value?parseInt(r.target.value):void 0),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent ${d.default_expiry_days?"border-red-300":"border-gray-300"}`,placeholder:"Es. 7 (giorni)"}),d.default_expiry_days&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:d.default_expiry_days}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Numero di giorni dopo l'acquisto prima della scadenza"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Allergeni Comuni"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Seleziona gli allergeni che sono comunemente presenti in questa categoria"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:Fe.map(r=>e.jsxs("label",{className:"flex items-center gap-2 p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s.allergen_info.includes(r),onChange:()=>y(r),className:"w-4 h-4 text-green-600 border-gray-300 rounded focus:ring-green-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700 capitalize",children:r.replace("_"," ")})]},r))})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-6 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:o,className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",children:"Annulla"}),e.jsxs("button",{type:"submit",disabled:m,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center gap-2",children:[m&&e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),a?"Aggiorna":"Crea"," Categoria"]})]})]})]})}):null}function Oe({alert:t,onMarkAsExpired:o}){const c=()=>{switch(t.alert_level){case"expired":return{container:"bg-red-50 border-red-200",icon:"text-red-600",title:"text-red-800",description:"text-red-600",button:"bg-red-100 text-red-700 hover:bg-red-200"};case"critical":return{container:"bg-orange-50 border-orange-200",icon:"text-orange-600",title:"text-orange-800",description:"text-orange-600",button:"bg-orange-100 text-orange-700 hover:bg-orange-200"};case"warning":return{container:"bg-yellow-50 border-yellow-200",icon:"text-yellow-600",title:"text-yellow-800",description:"text-yellow-600",button:"bg-yellow-100 text-yellow-700 hover:bg-yellow-200"};default:return{container:"bg-gray-50 border-gray-200",icon:"text-gray-600",title:"text-gray-800",description:"text-gray-600",button:"bg-gray-100 text-gray-700 hover:bg-gray-200"}}},a=()=>{switch(t.alert_level){case"expired":return e.jsx(te,{className:"w-5 h-5"});case"critical":return e.jsx(T,{className:"w-5 h-5"});case"warning":return e.jsx(B,{className:"w-5 h-5"});default:return e.jsx(O,{className:"w-5 h-5"})}},m=()=>{switch(t.alert_level){case"expired":return`Scaduto da ${Math.abs(t.days_until_expiry)} giorni`;case"critical":return`Scade tra ${t.days_until_expiry} giorni`;case"warning":return`Scade tra ${t.days_until_expiry} giorni`;default:return`Scade tra ${t.days_until_expiry} giorni`}},s=c();return e.jsx("div",{className:`p-4 rounded-lg border ${s.container}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx("div",{className:`${s.icon} mt-0.5`,children:a()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:`font-medium ${s.title}`,children:t.product_name}),e.jsx("p",{className:`text-sm ${s.description}`,children:m()}),e.jsxs("p",{className:`text-xs ${s.description} mt-1`,children:["Scadenza: ",t.expiry_date.toLocaleDateString("it-IT")]})]})]}),t.alert_level==="expired"&&e.jsx("button",{onClick:o,className:`px-3 py-1 rounded-md text-sm font-medium transition-colors ${s.button}`,children:"Marca come Scaduto"})]})})}function Re({categories:t,selectedCategory:o,onCategoryChange:c,isLoading:a=!1}){const m=t.find(s=>s.id===o)?.name;return e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:o||"",onChange:s=>c(s.target.value||null),disabled:a,className:"appearance-none w-full px-4 py-2 pr-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white disabled:bg-gray-50 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"",children:"Tutte le categorie"}),t.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:a?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-gray-400"}):e.jsx(Ee,{className:"w-4 h-4 text-gray-400"})}),m&&e.jsx("div",{className:"absolute -top-2 -right-2",children:e.jsxs("div",{className:"bg-blue-100 text-blue-800 text-xs font-medium px-2 py-1 rounded-full flex items-center gap-1",children:[m,e.jsx("button",{onClick:()=>c(null),className:"hover:bg-blue-200 rounded-full p-0.5",children:e.jsx(W,{className:"w-3 h-3"})})]})})]})}const Ue=({product:t,isOpen:o,onClose:c,onConfirm:a})=>{const[m,s]=f.useState(""),[l,d]=f.useState(!1),g=async p=>{if(p.preventDefault(),!!m){d(!0);try{const i=new Date(m);a(i),c(),s("")}catch{j.error("Errore nella data di scadenza")}finally{d(!1)}}};return o?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-orange-100 rounded-lg",children:e.jsx(ae,{className:"h-5 w-5 text-orange-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Reinserisci Prodotto"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:[e.jsx("strong",{children:"Prodotto:"})," ",t.name]}),e.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:[e.jsx("strong",{children:"Categoria:"})," ",t.category_name]}),e.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:[e.jsx("strong",{children:"Scadenza originale:"})," ",new Date(t.expiry_date).toLocaleDateString("it-IT")]}),t.reinsertion_count>0&&e.jsxs("p",{className:"text-sm text-orange-600 mb-2",children:[e.jsx("strong",{children:"Reinserimenti precedenti:"})," ",t.reinsertion_count]})]}),e.jsxs("form",{onSubmit:g,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"newExpiryDate",className:"block text-sm font-medium text-gray-700 mb-1",children:"Nuova Data di Scadenza"}),e.jsx("input",{type:"date",id:"newExpiryDate",value:m,onChange:p=>s(p.target.value),min:new Date().toISOString().split("T")[0],className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{className:"flex space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:c,className:"flex-1 px-4 py-2 text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200 transition-colors",children:"Annulla"}),e.jsx("button",{type:"submit",disabled:l||!m,className:"flex-1 px-4 py-2 bg-orange-600 text-white rounded-md hover:bg-orange-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:l?"Reinserendo...":"Reinserisci"})]})]})]})}):null},Qe=({product:t,onReinsert:o,onDelete:c,reinsertExpiredProduct:a})=>{const[m,s]=f.useState(!1),[l,d]=f.useState(!1),g=y=>{a?a({expiredProductId:t.id,newExpiryDate:y,newQuantity:t.quantity,notes:`Reinserito da prodotto scaduto - ${t.name}`}):o(t.id)},p=()=>{const y=new Date,n=new Date(t.expiry_date),b=y.getTime()-n.getTime();return Math.ceil(b/(1e3*60*60*24))},i=()=>t.quantity*2.5;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-red-100 rounded-lg",children:e.jsx(T,{className:"h-5 w-5 text-red-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:t.name}),e.jsx("p",{className:"text-sm text-gray-600",children:t.category_name})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800",children:["Scaduto da ",p()," giorni"]})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(M,{className:"h-4 w-4 text-gray-400"}),e.jsxs("span",{className:"text-sm text-gray-600",children:["Quantità: ",t.quantity," ",t.unit]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(O,{className:"h-4 w-4 text-gray-400"}),e.jsxs("span",{className:"text-sm text-gray-600",children:["Scaduto:"," ",new Date(t.expiry_date).toLocaleDateString("it-IT")]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ce,{className:"h-4 w-4 text-gray-400"}),e.jsxs("span",{className:"text-sm text-gray-600",children:["Costo spreco: €",i().toFixed(2)]})]}),t.reinsertion_count>0&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(re,{className:"h-4 w-4 text-orange-400"}),e.jsxs("span",{className:"text-sm text-orange-600",children:["Reinserito ",t.reinsertion_count," volte"]})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:()=>s(!0),className:"flex-1 inline-flex items-center justify-center px-3 py-2 text-sm font-medium text-orange-700 bg-orange-100 rounded-md hover:bg-orange-200 transition-colors",children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),"Reinserisci"]}),e.jsxs("button",{onClick:()=>d(!0),className:"flex-1 inline-flex items-center justify-center px-3 py-2 text-sm font-medium text-red-700 bg-red-100 rounded-md hover:bg-red-200 transition-colors",children:[e.jsx(ee,{className:"h-4 w-4 mr-2"}),"Elimina"]})]}),l&&e.jsxs("div",{className:"mt-3 p-3 bg-red-50 border border-red-200 rounded-md",children:[e.jsx("p",{className:"text-sm text-red-800 mb-3",children:"Sei sicuro di voler eliminare definitivamente questo prodotto? Questa azione non può essere annullata."}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>d(!1),className:"px-3 py-1 text-sm text-gray-600 bg-gray-100 rounded hover:bg-gray-200",children:"Annulla"}),e.jsx("button",{onClick:()=>{c(t.id),d(!1)},className:"px-3 py-1 text-sm text-white bg-red-600 rounded hover:bg-red-700",children:"Elimina Definitivamente"})]})]})]}),e.jsx(Ue,{product:t,isOpen:m,onClose:()=>s(!1),onConfirm:g})]})},$e=({expiredProducts:t,onReinsertProduct:o,onDeleteProduct:c,isLoading:a=!1,reinsertExpiredProduct:m})=>{const s=t.reduce((d,g)=>d+g.quantity*2.5,0),l=()=>{const d=new Date;return t.reduce((g,p)=>{const i=new Date(p.expiry_date),y=d.getTime()-i.getTime(),n=Math.ceil(y/(1e3*60*60*24));return g+n},0)};return e.jsx($,{title:"Prodotti Scaduti",icon:T,counter:t.length,defaultExpanded:!0,isLoading:a,isEmpty:!a&&t.length===0,emptyMessage:"Ottimo lavoro! Non ci sono prodotti scaduti da gestire.",contentClassName:"px-4 py-6 sm:px-6",children:!a&&t.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:t.length}),e.jsx("div",{className:"text-sm text-gray-600",children:"Prodotti Scaduti"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:l()}),e.jsx("div",{className:"text-sm text-gray-600",children:"Giorni Totali di Scadenza"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-red-600",children:["€",s.toFixed(2)]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Costo Stimato Spreco"})]})]}),e.jsx("div",{className:"space-y-3",children:t.map(d=>e.jsx(Qe,{product:d,onReinsert:o,onDelete:c,reinsertExpiredProduct:m},d.id))})]})})};function Ke(){const[t,o]=f.useState(!1),[c,a]=f.useState(!1),[m,s]=f.useState(null),[l,d]=f.useState(null),[g,p]=f.useState(""),[i,y]=f.useState(null),[n,b]=f.useState(!1),{products:r,stats:u,isLoading:h,createProduct:q,updateProduct:P,deleteProduct:_,updateProductStatus:v,isCreating:w,isUpdating:S}=ve({filters:{category_id:i||void 0,status:n?"expired":void 0}}),{categories:E,isLoading:k,createCategory:se,updateCategory:ie,deleteCategory:ne}=ke(),{expiryAlerts:F,expiryStats:V,isLoading:R,markAsExpired:oe}=Ae(7),{expiredProducts:le,isLoadingExpired:de,reinsertExpiredProduct:ce,deleteExpiredProduct:ue}=Ie(),me=x=>{q(x,{onSuccess:()=>{o(!1)}})},xe=x=>{m&&P({id:m.id,...x},{onSuccess:()=>{s(null)}})},ge=x=>{se(x,{onSuccess:()=>{a(!1)}})},pe=x=>{l&&ie({id:l.id,...x},{onSuccess:()=>{d(null)}})},ye=x=>{window.confirm("Sei sicuro di voler eliminare questo prodotto?")&&_(x)},he=x=>{window.confirm("Sei sicuro di voler eliminare questa categoria?")&&ne(x)},be=x=>{},fe=x=>{ue.mutate(x)},U=h||k||R;return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Inventario"}),e.jsx("p",{className:"text-gray-600",children:"Gestisci prodotti, scadenze e liste della spesa"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>a(!0),className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors flex items-center gap-2",children:[e.jsx(X,{className:"w-4 h-4"}),"Categoria"]}),e.jsxs("button",{onClick:()=>o(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2",children:[e.jsx(X,{className:"w-4 h-4"}),"Prodotto"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Totale Prodotti"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:u?.total_products||0})]}),e.jsx(M,{className:"w-8 h-8 text-blue-600"})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Attivi"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:u?.active_products||0})]}),e.jsx(re,{className:"w-8 h-8 text-green-600"})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"In Scadenza"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:V?.total_expiring||0})]}),e.jsx(B,{className:"w-8 h-8 text-yellow-600"})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Scaduti"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:V?.expired_count||0})]}),e.jsx(T,{className:"w-8 h-8 text-red-600"})]})})]}),e.jsx("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(qe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"Cerca prodotti...",value:g,onChange:x=>p(x.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsx(Re,{categories:E,selectedCategory:i,onCategoryChange:y,isLoading:k}),e.jsxs("button",{onClick:()=>b(!n),className:`px-4 py-2 rounded-lg border transition-colors flex items-center gap-2 ${n?"bg-red-100 border-red-300 text-red-700":"bg-gray-100 border-gray-300 text-gray-700 hover:bg-gray-200"}`,children:[e.jsx(Pe,{className:"w-4 h-4"}),"Solo Scaduti"]})]})}),F.length>0&&e.jsx($,{title:"Prodotti in Scadenza",icon:T,counter:F.length,defaultExpanded:!0,isLoading:R,isEmpty:!R&&F.length===0,emptyMessage:"Nessun prodotto in scadenza nei prossimi giorni.",contentClassName:"px-4 py-6 sm:px-6",children:!R&&F.length>0&&e.jsx("div",{className:"space-y-3",children:F.map(x=>e.jsx(Oe,{alert:x,onMarkAsExpired:()=>oe(x.product_id)},x.product_id))})}),e.jsxs($,{title:"Prodotti",icon:M,counter:r.length,defaultExpanded:!0,isLoading:U,isEmpty:!U&&r.length===0,emptyMessage:"Nessun prodotto presente. Aggiungi il primo dal pulsante in alto.",contentClassName:"px-4 py-6 sm:px-6",emptyActionLabel:"Aggiungi il primo prodotto",onEmptyAction:()=>o(!0),children:[!U&&r.length>0&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:r.map(x=>e.jsx(ze,{product:x,onEdit:()=>s(x),onDelete:()=>ye(x.id),onStatusChange:je=>v({id:x.id,status:je})},x.id))}),!U&&r.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:e.jsx("button",{onClick:()=>o(!0),className:"text-blue-600 hover:text-blue-700 font-medium",children:"Aggiungi il primo prodotto"})})]}),e.jsx($e,{expiredProducts:le,onReinsertProduct:be,onDeleteProduct:fe,isLoading:de,reinsertExpiredProduct:ce.mutate}),e.jsxs($,{title:"Categorie Prodotti",icon:De,counter:E.length,defaultExpanded:!1,isLoading:k,isEmpty:!k&&E.length===0,emptyMessage:"Nessuna categoria creata. Usa il pulsante in alto per aggiungerne una.",contentClassName:"px-4 py-6 sm:px-6",emptyActionLabel:"Aggiungi la prima categoria",onEmptyAction:()=>a(!0),children:[!k&&E.length>0&&e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:E.map(x=>e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:x.name}),x.description&&e.jsx("p",{className:"text-sm text-gray-600",children:x.description})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>d(x),className:"p-1 text-gray-400 hover:text-gray-600",children:"✏️"}),e.jsx("button",{onClick:()=>he(x.id),className:"p-1 text-gray-400 hover:text-red-600",children:"🗑️"})]})]})},x.id))}),!k&&E.length===0&&e.jsx("div",{className:"text-center py-6 text-gray-500",children:e.jsx("button",{onClick:()=>a(!0),className:"text-green-600 hover:text-green-700 font-medium",children:"Aggiungi la prima categoria"})})]}),t&&e.jsx(Z,{isOpen:t,onClose:()=>o(!1),onSubmit:me,categories:E,isLoading:w}),m&&e.jsx(Z,{isOpen:!!m,onClose:()=>s(null),onSubmit:xe,product:m,categories:E,isLoading:S}),c&&e.jsx(J,{isOpen:c,onClose:()=>a(!1),onSubmit:ge,isLoading:w}),l&&e.jsx(J,{isOpen:!!l,onClose:()=>d(null),onSubmit:pe,category:l,isLoading:S})]})}const Ve=Object.freeze(Object.defineProperty({__proto__:null,default:Ke},Symbol.toStringTag,{value:"Module"}));export{C as A,Ve as I};
