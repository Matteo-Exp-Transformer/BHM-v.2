import{r as N}from"./react-vendor-C-olevxG.js";import{a as Z,u as ee,b as D,j as e}from"./query-vendor-yChzfXyf.js";import{u as te,s as T,b as X,T as O,c as je,M as K,g as fe,d as J,e as ve,f as Ne,C as B}from"./calendar-features-C85Z3oOU.js";import{B as y,M as ye,S as G,T as L,o as R,f as se,e as w,d as z,X as ae,I as _e,g as q,W as F,s as re,b as k,U as ne,t as we,k as Ce}from"./ui-vendor-Cbmmx1ZO.js";const M={departments:t=>["departments",t],department:t=>["department",t]},Se=()=>{const{userProfile:t}=te(),d=Z(),u=t?.company_id,{data:a=[],isLoading:v,error:h,refetch:g}=ee({queryKey:M.departments(u||""),queryFn:async()=>{if(!u)throw new Error("Company ID not found");const{data:r,error:c}=await T.from("departments").select("*").eq("company_id",u).order("name",{ascending:!0});if(c)throw c;return r||[]},enabled:!!u,staleTime:5*60*1e3}),l=D({mutationFn:async r=>{if(!u)throw new Error("Company ID not found");const{data:c,error:o}=await T.from("departments").insert({company_id:u,name:r.name,description:r.description||null,is_active:r.is_active??!0}).select().single();if(o)throw o;return c},onSuccess:r=>{d.setQueryData(M.departments(u||""),(c=[])=>[...c,r]),y.success(`Reparto "${r.name}" creato con successo`)},onError:r=>{console.error("Error creating department:",r),y.error(`Errore nella creazione del reparto: ${r.message}`)}}),m=D({mutationFn:async({id:r,input:c})=>{const{data:o,error:p}=await T.from("departments").update({name:c.name,description:c.description||null,is_active:c.is_active,updated_at:new Date().toISOString()}).eq("id",r).select().single();if(p)throw p;return o},onSuccess:r=>{d.setQueryData(M.departments(u||""),(c=[])=>c.map(o=>o.id===r.id?r:o)),y.success(`Reparto "${r.name}" aggiornato con successo`)},onError:r=>{console.error("Error updating department:",r),y.error(`Errore nell'aggiornamento del reparto: ${r.message}`)}}),j=D({mutationFn:async r=>{const{error:c}=await T.from("departments").delete().eq("id",r);if(c)throw c},onSuccess:(r,c)=>{d.setQueryData(M.departments(u||""),(o=[])=>o.filter(p=>p.id!==c)),y.success("Reparto eliminato con successo")},onError:r=>{console.error("Error deleting department:",r),y.error(`Errore nell'eliminazione del reparto: ${r.message}`)}}),s=D({mutationFn:async({id:r,isActive:c})=>{const{data:o,error:p}=await T.from("departments").update({is_active:c,updated_at:new Date().toISOString()}).eq("id",r).select().single();if(p)throw p;return o},onSuccess:r=>{d.setQueryData(M.departments(u||""),(o=[])=>o.map(p=>p.id===r.id?r:p));const c=r.is_active?"attivato":"disattivato";y.success(`Reparto "${r.name}" ${c} con successo`)},onError:r=>{console.error("Error toggling department status:",r),y.error(`Errore nel cambio stato del reparto: ${r.message}`)}}),x=D({mutationFn:async()=>{if(!u)throw new Error("Company ID not found");const r=[{name:"Bancone",description:"Area di servizio al bancone"},{name:"Sala",description:"Area di servizio ai tavoli"},{name:"Magazzino",description:"Area di stoccaggio prodotti"},{name:"Cucina",description:"Area di preparazione e cottura"}],{data:c,error:o}=await T.from("departments").insert(r.map(p=>({company_id:u,name:p.name,description:p.description,is_active:!0}))).select();if(o)throw o;return c||[]},onSuccess:r=>{d.setQueryData(M.departments(u||""),(c=[])=>[...c,...r]),y.success(`${r.length} reparti predefiniti creati con successo`)},onError:r=>{console.error("Error creating preset departments:",r),y.error(`Errore nella creazione dei reparti predefiniti: ${r.message}`)}}),b={total:a.length,active:a.filter(r=>r.is_active).length,inactive:a.filter(r=>!r.is_active).length};return{departments:a,stats:b,isLoading:v,isCreating:l.isPending,isUpdating:m.isPending,isDeleting:j.isPending,isToggling:s.isPending,isCreatingPresets:x.isPending,error:h,createError:l.error,updateError:m.error,deleteError:j.error,createDepartment:l.mutate,updateDepartment:m.mutate,deleteDepartment:j.mutate,toggleDepartmentStatus:s.mutate,createPresetDepartments:x.mutate,refetch:g,getDepartmentById:r=>a.find(c=>c.id===r),getDepartmentsByStatus:r=>a.filter(c=>c.is_active===r)}};function ze(t){const d=Z(),u=[{id:"1",company_id:"test",conservation_point_id:"1",temperature:4.2,target_temperature:4,tolerance_range_min:2,tolerance_range_max:6,status:"compliant",recorded_by:"user1",recorded_at:new Date(Date.now()-2*60*60*1e3),method:"digital_thermometer",notes:"Lettura regolare",validation_status:"validated",created_at:new Date},{id:"2",company_id:"test",conservation_point_id:"1",temperature:6.5,target_temperature:4,tolerance_range_min:2,tolerance_range_max:6,status:"warning",recorded_by:"user2",recorded_at:new Date(Date.now()-4*60*60*1e3),method:"manual",notes:"Temperatura leggermente alta",validation_status:"flagged",created_at:new Date},{id:"3",company_id:"test",conservation_point_id:"2",temperature:-18.1,target_temperature:-18,tolerance_range_min:-20,tolerance_range_max:-16,status:"compliant",recorded_by:"user1",recorded_at:new Date(Date.now()-1*60*60*1e3),method:"automatic_sensor",notes:"Sensore automatico",validation_status:"validated",created_at:new Date},{id:"4",company_id:"test",conservation_point_id:"3",temperature:8.2,target_temperature:6,tolerance_range_min:4,tolerance_range_max:8,status:"warning",recorded_by:"user3",recorded_at:new Date(Date.now()-30*60*1e3),method:"digital_thermometer",notes:"Vetrina esposta al sole",validation_status:"pending",created_at:new Date},{id:"5",company_id:"test",conservation_point_id:"4",temperature:-32,target_temperature:-35,tolerance_range_min:-40,tolerance_range_max:-30,status:"critical",recorded_by:"user1",recorded_at:new Date(Date.now()-10*60*1e3),method:"manual",notes:"Abbattitore non raggiunge temperatura",validation_status:"flagged",created_at:new Date}],{data:a,isLoading:v,error:h}=ee({queryKey:["temperature-readings",t],queryFn:async()=>(console.log("🔧 Using mock data for temperature readings"),u),enabled:!0}),g=D({mutationFn:async s=>(console.log("🔧 Mock saving temperature reading:",s),await new Promise(b=>setTimeout(b,500)),{id:`mock-${Date.now()}`,company_id:"test",recorded_at:new Date,validation_status:"pending",...s}),onSuccess:()=>{d.invalidateQueries({queryKey:["temperature-readings"]}),d.invalidateQueries({queryKey:["conservation-points"]}),y.success("Lettura temperatura registrata")},onError:s=>{console.error("Error creating temperature reading:",s),y.error("Errore nella registrazione della temperatura")}}),l=D({mutationFn:async({id:s,data:x})=>{const{data:b,error:r}=await T.from("temperature_readings").update(x).eq("id",s).select().single();if(r)throw r;return b},onSuccess:()=>{d.invalidateQueries({queryKey:["temperature-readings"]}),y.success("Lettura aggiornata")},onError:s=>{console.error("Error updating temperature reading:",s),y.error("Errore nell'aggiornamento della lettura")}}),m=D({mutationFn:async s=>{const{error:x}=await T.from("temperature_readings").delete().eq("id",s);if(x)throw x},onSuccess:()=>{d.invalidateQueries({queryKey:["temperature-readings"]}),y.success("Lettura eliminata")},onError:s=>{console.error("Error deleting temperature reading:",s),y.error("Errore nell'eliminazione della lettura")}}),j={total:a?.length||0,compliant:a?.filter(s=>s.status==="compliant").length||0,warning:a?.filter(s=>s.status==="warning").length||0,critical:a?.filter(s=>s.status==="critical").length||0,byMethod:{manual:a?.filter(s=>s.method==="manual").length||0,digital_thermometer:a?.filter(s=>s.method==="digital_thermometer").length||0,automatic_sensor:a?.filter(s=>s.method==="automatic_sensor").length||0},byValidation:{pending:a?.filter(s=>s.validation_status==="pending").length||0,validated:a?.filter(s=>s.validation_status==="validated").length||0,flagged:a?.filter(s=>s.validation_status==="flagged").length||0}};return{temperatureReadings:a||[],isLoading:v,error:h,stats:j,createReading:g.mutate,updateReading:l.mutate,deleteReading:m.mutate,isCreating:g.isPending,isUpdating:l.isPending,isDeleting:m.isPending}}function Te({point:t,onEdit:d,onDelete:u}){const[a,v]=N.useState(!1),h=X[t.status]||X.normal,g=O[t.type]||O.ambient,l=()=>{switch(t.type){case"ambient":return"🌡️";case"fridge":return"❄️";case"freezer":return"🧊";case"blast":return"⚡";default:return"📦"}},m=()=>{switch(t.type){case"ambient":return"Ambiente";case"fridge":return"Frigorifero";case"freezer":return"Freezer";case"blast":return"Abbattitore";default:return"Non definito"}},j=()=>{switch(t.status){case"normal":return e.jsx(z,{className:"w-5 h-5 text-green-600"});case"warning":return e.jsx(w,{className:"w-5 h-5 text-yellow-600"});case"critical":return e.jsx(w,{className:"w-5 h-5 text-red-600"})}},s=()=>{switch(t.status){case"normal":return"Regolare";case"warning":return"Attenzione";case"critical":return"Critico"}};return e.jsxs("div",{className:`rounded-lg border-2 ${h.border} ${h.bg} p-4 transition-all duration-200 hover:shadow-md`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"text-2xl",children:l()}),e.jsxs("div",{children:[e.jsx("h3",{className:`font-semibold ${h.text}`,children:t.name}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[e.jsx(ye,{className:"w-4 h-4"}),e.jsx("span",{children:t.department?.name||"Reparto non assegnato"}),e.jsx("span",{className:"mx-1",children:"•"}),e.jsx("span",{children:m()})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[j(),e.jsx("button",{onClick:()=>d(t),className:"p-1 text-gray-600 hover:text-blue-600 transition-colors",children:e.jsx(G,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>u(t.id),className:"p-1 text-gray-600 hover:text-red-600 transition-colors",children:e.jsx(L,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(R,{className:`w-4 h-4 ${h.text}`}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Temperatura target"}),e.jsxs("div",{className:`font-semibold ${h.text}`,children:[t.setpoint_temp,"°C"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${t.status==="normal"?"bg-green-400":t.status==="warning"?"bg-yellow-400":"bg-red-400"}`}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Stato"}),e.jsx("div",{className:`font-semibold ${h.text}`,children:s()})]})]})]}),t.last_temperature_reading&&e.jsx("div",{className:`rounded-md ${h.bg} border ${h.border} p-3 mb-3`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Ultima lettura"}),e.jsxs("div",{className:`font-semibold ${h.text}`,children:[t.last_temperature_reading.temperature,"°C"]})]}),e.jsx("div",{className:"text-xs text-gray-500",children:new Date(t.last_temperature_reading.recorded_at).toLocaleDateString("it-IT",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})})]})}),t.maintenance_due&&e.jsxs("div",{className:"flex items-center space-x-2 text-sm",children:[e.jsx(se,{className:"w-4 h-4 text-gray-600"}),e.jsxs("span",{className:"text-gray-600",children:["Prossima manutenzione:"," ",new Date(t.maintenance_due).toLocaleDateString("it-IT")]})]}),t.product_categories&&t.product_categories.length>0&&e.jsxs("div",{className:"mt-3",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"Categorie prodotti:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:t.product_categories.map((x,b)=>e.jsx("span",{className:"px-2 py-1 bg-white bg-opacity-50 rounded text-xs font-medium",children:x},b))})]}),e.jsx("button",{onClick:()=>v(!a),className:"mt-3 text-sm text-blue-600 hover:text-blue-800 transition-colors",children:a?"Nascondi dettagli":"Mostra dettagli"}),a&&e.jsxs("div",{className:"mt-3 p-3 bg-white bg-opacity-50 rounded border space-y-2",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("strong",{children:"Range di temperatura:"})," ",g.min,"°C -"," ",g.max,"°C"]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("strong",{children:"Temperatura ottimale:"})," ",g.optimal,"°C"]}),t.is_blast_chiller&&e.jsx("div",{className:"text-sm text-blue-600",children:e.jsx("strong",{children:"⚡ Abbattitore attivo"})}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Creato il"," ",new Date(t.created_at).toLocaleDateString("it-IT",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})]})]})]})}const De=["Carni fresche","Carni trasformate","Pesce fresco","Pesce trasformato","Latticini","Uova","Verdure fresche","Verdure trasformate","Frutta fresca","Frutta trasformata","Prodotti da forno","Bevande","Condimenti","Conserve","Surgelati","Gelati","Prodotti secchi","Altri"];function ke({task:t,index:d,staff:u,onUpdate:a,onRemove:v}){const[h,g]=N.useState(!0),l=(s,x)=>{a(d,{...t,[s]:x})},j=K[t.type]||{label:"Altro",icon:"tool",color:"gray",defaultDuration:60,defaultChecklist:[]};return e.jsxs("div",{className:"border border-gray-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"button",onClick:()=>g(!h),className:"text-gray-400 hover:text-gray-600",children:h?"▼":"▶"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:t.title}),e.jsxs("p",{className:"text-sm text-gray-500",children:[j.label," • ",t.frequency," • ",t.estimated_duration,"min"]})]})]}),e.jsx("button",{type:"button",onClick:()=>v(d),className:"text-red-500 hover:text-red-700",children:e.jsx(L,{className:"w-4 h-4"})})]}),h&&e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Titolo *"}),e.jsx("input",{type:"text",value:t.title,onChange:s=>l("title",s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Nome della manutenzione"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo *"}),e.jsx("select",{value:t.type,onChange:s=>l("type",s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:Object.entries(K).map(([s,x])=>e.jsx("option",{value:s,children:x.label},s))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Frequenza *"}),e.jsxs("select",{value:t.frequency,onChange:s=>l("frequency",s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"daily",children:"Giornaliera"}),e.jsx("option",{value:"weekly",children:"Settimanale"}),e.jsx("option",{value:"monthly",children:"Mensile"}),e.jsx("option",{value:"quarterly",children:"Trimestrale"}),e.jsx("option",{value:"annually",children:"Annuale"}),e.jsx("option",{value:"custom",children:"Personalizzata"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Durata (min) *"}),e.jsx("input",{type:"number",min:"5",step:"5",value:t.estimated_duration,onChange:s=>l("estimated_duration",parseInt(s.target.value)||30),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Priorità *"}),e.jsxs("select",{value:t.priority,onChange:s=>l("priority",s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"low",children:"Bassa"}),e.jsx("option",{value:"medium",children:"Media"}),e.jsx("option",{value:"high",children:"Alta"}),e.jsx("option",{value:"critical",children:"Critica"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Assegnato a"}),e.jsxs("select",{value:t.assigned_to||"",onChange:s=>l("assigned_to",s.target.value||void 0),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Assegnazione automatica"}),u.map(s=>e.jsxs("option",{value:s.id,children:[s.name," (",s.role,")"]},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Prima scadenza *"}),e.jsx("input",{type:"datetime-local",value:t.next_due.toISOString().slice(0,16),onChange:s=>l("next_due",new Date(s.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx("button",{type:"button",onClick:()=>l("instructions",j.defaultChecklist),className:"text-xs px-2 py-1 bg-blue-100 text-blue-700 rounded hover:bg-blue-200",children:"Carica checklist standard"})})]})]})}function Ee({isOpen:t,onClose:d,onSave:u,point:a,isLoading:v}){const{departments:h}=Se(),{staff:g}=je(),[l,m]=N.useState({name:"",department_id:"",setpoint_temp:4,is_blast_chiller:!1,product_categories:[],maintenance_due:""}),[j,s]=N.useState([]),[x,b]=N.useState("fridge"),[r,c]=N.useState(!1);N.useEffect(()=>{a?(m({name:a.name,department_id:a.department_id||"",setpoint_temp:a.setpoint_temp,is_blast_chiller:a.is_blast_chiller,product_categories:a.product_categories||[],maintenance_due:a.maintenance_due?new Date(a.maintenance_due).toISOString().split("T")[0]:""}),s(a.maintenance_tasks?.map(i=>({id:i.id,title:i.title,type:i.type,frequency:i.frequency,estimated_duration:i.estimated_duration,assigned_to:i.assigned_to,priority:i.priority,next_due:new Date(i.next_due),instructions:i.checklist}))||[])):(m({name:"",department_id:"",setpoint_temp:4,is_blast_chiller:!1,product_categories:[],maintenance_due:""}),s([]))},[a,t]),N.useEffect(()=>{const i=l.setpoint_temp,f=l.is_blast_chiller;let _="fridge";f?_="blast":i>=15&&i<=25?_="ambient":i>=0&&i<=8?_="fridge":i>=-25&&i<=-15&&(_="freezer"),b(_)},[l.setpoint_temp,l.is_blast_chiller]);const o=i=>{i.preventDefault(),u({name:l.name,department_id:l.department_id,setpoint_temp:l.setpoint_temp,type:x,is_blast_chiller:l.is_blast_chiller,product_categories:l.product_categories,maintenance_due:l.maintenance_due?new Date(l.maintenance_due):void 0},j)},p=()=>{const i={title:"Nuova Manutenzione",type:"general_inspection",frequency:"weekly",estimated_duration:30,priority:"medium",next_due:new Date(Date.now()+6048e5),instructions:[]};s([...j,i])},I=(i,f)=>{const _=[...j];_[i]=f,s(_)},P=i=>{s(j.filter((f,_)=>_!==i))},E=i=>{m(f=>({...f,product_categories:f.product_categories.includes(i)?f.product_categories.filter(_=>_!==i):[...f.product_categories,i]}))},U=()=>{const i=O[x]||O.fridge;return{name:{ambient:"Ambiente",fridge:"Frigorifero",freezer:"Freezer",blast:"Abbattitore"}[x]||"Frigorifero",range:`${i.min}°C - ${i.max}°C`,optimal:`${i.optimal}°C`,icon:x==="ambient"?"🌡️":x==="fridge"?"❄️":x==="freezer"?"🧊":"⚡"}};if(!t)return null;const A=U();return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsx("h2",{className:"text-xl font-semibold",children:a?"Modifica Punto di Conservazione":"Nuovo Punto di Conservazione"}),e.jsx("button",{onClick:d,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(ae,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:o,className:"p-6 space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome punto di conservazione *"}),e.jsx("input",{type:"text",required:!0,value:l.name,onChange:i=>m(f=>({...f,name:i.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"es. Frigorifero Cucina 1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Reparto *"}),e.jsxs("select",{required:!0,value:l.department_id,onChange:i=>m(f=>({...f,department_id:i.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Seleziona reparto"}),h.map(i=>e.jsx("option",{value:i.id,children:i.name},i.id))]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Temperatura target (°C) *"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(R,{className:"w-5 h-5 text-blue-600"}),e.jsx("input",{type:"number",required:!0,step:"0.1",min:"-99",max:"30",value:l.setpoint_temp,onChange:i=>m(f=>({...f,setpoint_temp:parseFloat(i.target.value)})),className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"is_blast_chiller",checked:l.is_blast_chiller,onChange:i=>m(f=>({...f,is_blast_chiller:i.target.checked})),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("label",{htmlFor:"is_blast_chiller",className:"text-sm font-medium text-gray-700",children:"Abbattitore di temperatura"})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(_e,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"font-medium text-blue-900",children:"Classificazione automatica"})]}),e.jsx("div",{className:"text-sm text-blue-800",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-lg",children:A.icon}),e.jsxs("span",{children:[e.jsx("strong",{children:A.name})," - Range: ",A.range," - Ottimale: ",A.optimal]})]})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Categorie prodotti conservati"}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{type:"button",onClick:()=>c(!r),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-left focus:outline-none focus:ring-2 focus:ring-blue-500",children:l.product_categories.length===0?"Seleziona categorie prodotti...":`${l.product_categories.length} categorie selezionate`}),r&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-y-auto",children:De.map(i=>e.jsxs("label",{className:"flex items-center px-3 py-2 hover:bg-gray-50 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:l.product_categories.includes(i),onChange:()=>E(i),className:"mr-2 rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm",children:i})]},i))})]}),l.product_categories.length>0&&e.jsx("div",{className:"mt-2 flex flex-wrap gap-1",children:l.product_categories.map(i=>e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full",children:i},i))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Manutenzioni Programmate"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Configura le manutenzioni per questo punto di conservazione"})]}),e.jsxs("button",{type:"button",onClick:p,className:"flex items-center gap-2 px-3 py-2 text-sm bg-green-600 text-white rounded-md hover:bg-green-700",children:[e.jsx(q,{className:"w-4 h-4"}),"Aggiungi"]})]}),j.length===0?e.jsxs("div",{className:"text-center py-8 border-2 border-dashed border-gray-300 rounded-lg",children:[e.jsx(F,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Nessuna manutenzione configurata"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Aggiungi manutenzioni per automatizzare il controllo"})]}):e.jsx("div",{className:"space-y-4",children:j.map((i,f)=>e.jsx(ke,{task:i,index:f,staff:g,onUpdate:I,onRemove:P},f))})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-6 border-t",children:[e.jsx("button",{type:"button",onClick:d,className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors",children:"Annulla"}),e.jsx("button",{type:"submit",disabled:v,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:v?"Salvando...":a?"Aggiorna":"Crea"})]})]})]})})}const Re=[{value:"manual",label:"Manuale",icon:"✍️"},{value:"digital_thermometer",label:"Termometro Digitale",icon:"🌡️"},{value:"automatic_sensor",label:"Sensore Automatico",icon:"📡"}];function Ae({isOpen:t,onClose:d,onSave:u,conservationPoint:a,isLoading:v}){const{user:h}=te(),[g,l]=N.useState({temperature:a.setpoint_temp,method:"digital_thermometer",notes:"",photo_evidence:""}),[m,j]=N.useState("compliant"),x=(()=>{switch(a.type){case"fridge":return{min:a.setpoint_temp-2,max:a.setpoint_temp+2};case"freezer":return{min:a.setpoint_temp-2,max:a.setpoint_temp+2};case"blast":return{min:a.setpoint_temp-5,max:a.setpoint_temp+5};case"ambient":return{min:a.setpoint_temp-3,max:a.setpoint_temp+3};default:return{min:a.setpoint_temp-2,max:a.setpoint_temp+2}}})();N.useEffect(()=>{let o=2;switch(a.type){case"blast":o=5;break;case"ambient":o=3;break}const p=fe(g.temperature,a.setpoint_temp,o);j(p==="normal"?"compliant":p)},[g.temperature,a.setpoint_temp,a.type]),N.useEffect(()=>{t&&l({temperature:a.setpoint_temp,method:"digital_thermometer",notes:"",photo_evidence:""})},[t,a.setpoint_temp]);const b=o=>{if(o.preventDefault(),!h?.id){console.error("No user ID available");return}u({conservation_point_id:a.id,temperature:g.temperature,target_temperature:a.setpoint_temp,tolerance_range_min:x.min,tolerance_range_max:x.max,status:m,recorded_by:h.id,method:g.method,notes:g.notes,photo_evidence:g.photo_evidence,created_at:new Date})},r=()=>{switch(m){case"compliant":return{icon:e.jsx(z,{className:"w-5 h-5 text-green-600"}),text:"Conforme",color:"text-green-900",bg:"bg-green-50",border:"border-green-200"};case"warning":return{icon:e.jsx(w,{className:"w-5 h-5 text-yellow-600"}),text:"Attenzione",color:"text-yellow-900",bg:"bg-yellow-50",border:"border-yellow-200"};case"critical":return{icon:e.jsx(w,{className:"w-5 h-5 text-red-600"}),text:"Critico",color:"text-red-900",bg:"bg-red-50",border:"border-red-200"};default:return{icon:e.jsx(z,{className:"w-5 h-5 text-green-600"}),text:"Conforme",color:"text-green-900",bg:"bg-green-50",border:"border-green-200"}}};if(!t)return null;const c=r()||{icon:e.jsx(z,{className:"w-5 h-5 text-green-600"}),text:"Conforme",color:"text-green-900",bg:"bg-green-50",border:"border-green-200"};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg w-full max-w-md max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Registra Temperatura"}),e.jsx("p",{className:"text-sm text-gray-600",children:a.name})]}),e.jsx("button",{onClick:d,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(ae,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:b,className:"p-6 space-y-6",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(R,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"font-medium text-blue-900",children:"Informazioni Punto"})]}),e.jsxs("div",{className:"text-sm text-blue-800 space-y-1",children:[e.jsxs("div",{children:["Temperatura target:"," ",e.jsxs("strong",{children:[a.setpoint_temp,"°C"]})]}),e.jsxs("div",{children:["Range tolleranza:"," ",e.jsxs("strong",{children:[x.min,"°C - ",x.max,"°C"]})]}),e.jsxs("div",{children:["Tipo:"," ",e.jsx("strong",{children:a.type==="fridge"?"Frigorifero":a.type==="freezer"?"Freezer":a.type==="blast"?"Abbattitore":"Ambiente"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Temperatura rilevata (°C) *"}),e.jsx("input",{type:"number",required:!0,step:"0.1",value:g.temperature,onChange:o=>l(p=>({...p,temperature:parseFloat(o.target.value)||0})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"es. 4.2"})]}),e.jsxs("div",{className:`rounded-lg border p-4 ${c.bg} ${c.border}`,children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[c.icon,e.jsxs("span",{className:`font-medium ${c.color}`,children:["Stato: ",c.text]})]}),m!=="compliant"&&e.jsx("div",{className:`text-sm mt-1 ${c.color}`,children:m==="warning"?"Temperatura fuori dal range ottimale":"Temperatura in range critico - Azione richiesta"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Metodo di rilevazione *"}),e.jsx("div",{className:"space-y-2",children:Re.map(o=>e.jsxs("label",{className:"flex items-center space-x-3 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"method",value:o.value,checked:g.method===o.value,onChange:p=>l(I=>({...I,method:p.target.value})),className:"text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-lg",children:o.icon}),e.jsx("span",{className:"text-sm",children:o.label})]},o.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Note aggiuntive"}),e.jsx("textarea",{value:g.notes,onChange:o=>l(p=>({...p,notes:o.target.value})),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Osservazioni, condizioni particolari..."})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[e.jsx(re,{className:"w-4 h-4 inline mr-1"}),"Foto evidenza (URL)"]}),e.jsx("input",{type:"url",value:g.photo_evidence,onChange:o=>l(p=>({...p,photo_evidence:o.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"https://..."}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Opzionale: URL della foto del termometro o del punto di misurazione"})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-6 border-t",children:[e.jsx("button",{type:"button",onClick:d,className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors",children:"Annulla"}),e.jsx("button",{type:"submit",disabled:v,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:v?"Registrando...":"Registra"})]})]})]})})}function $e({reading:t,onEdit:d,onDelete:u,showActions:a=!0}){const v=()=>{switch(t.status){case"compliant":return{icon:e.jsx(z,{className:"w-4 h-4 text-green-600"}),text:"Conforme",color:"text-green-900",bg:"bg-green-50",border:"border-green-200"};case"warning":return{icon:e.jsx(w,{className:"w-4 h-4 text-yellow-600"}),text:"Attenzione",color:"text-yellow-900",bg:"bg-yellow-50",border:"border-yellow-200"};case"critical":return{icon:e.jsx(w,{className:"w-4 h-4 text-red-600"}),text:"Critico",color:"text-red-900",bg:"bg-red-50",border:"border-red-200"}}},h=()=>{switch(t.method){case"manual":return{icon:"✍️",text:"Manuale"};case"digital_thermometer":return{icon:"🌡️",text:"Termometro Digitale"};case"automatic_sensor":return{icon:"📡",text:"Sensore Automatico"};default:return{icon:"❓",text:"Non specificato"}}},g=()=>{if(!t.validation_status)return{icon:e.jsx(k,{className:"w-3 h-3 text-gray-400"}),text:"Non validata",color:"text-gray-400"};switch(t.validation_status){case"validated":return{icon:e.jsx(z,{className:"w-3 h-3 text-green-600"}),text:"Validata",color:"text-green-600"};case"flagged":return{icon:e.jsx(w,{className:"w-3 h-3 text-red-600"}),text:"Segnalata",color:"text-red-600"};case"pending":return{icon:e.jsx(k,{className:"w-3 h-3 text-yellow-600"}),text:"In attesa",color:"text-yellow-600"}}},l=b=>new Date(b).toLocaleDateString("it-IT",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),m=v(),j=h(),s=g(),x=t.temperature<(t.tolerance_range_min??0)||t.temperature>(t.tolerance_range_max??0);return e.jsxs("div",{className:`rounded-lg border-2 p-4 transition-all duration-200 hover:shadow-md ${m.bg} ${m.border}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`p-2 rounded-full ${m.bg}`,children:e.jsx(R,{className:`w-5 h-5 ${t.status==="compliant"?"text-green-600":t.status==="warning"?"text-yellow-600":"text-red-600"}`})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:`text-2xl font-bold ${m.color}`,children:[t.temperature,"°C"]}),m.icon]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Target: ",t.target_temperature??0,"°C"]})]})]}),a&&d&&u&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("button",{onClick:()=>d(t),className:"p-1 text-gray-600 hover:text-blue-600 transition-colors",children:e.jsx(G,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>u(t.id),className:"p-1 text-gray-600 hover:text-red-600 transition-colors",children:e.jsx(L,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-600",children:"Range tolleranza"}),e.jsxs("div",{className:"text-sm font-medium",children:[t.tolerance_range_min,"°C - ",t.tolerance_range_max,"°C"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-600",children:"Scostamento"}),e.jsxs("div",{className:`text-sm font-medium ${x?"text-red-600":"text-green-600"}`,children:[t.temperature>(t.target_temperature??0)?"+":"",(t.temperature-(t.target_temperature??0)).toFixed(1),"°C"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(k,{className:"w-4 h-4 text-gray-600"}),e.jsx("span",{className:"text-gray-600",children:l(t.recorded_at)})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[s.icon,e.jsx("span",{className:`text-xs ${s.color}`,children:s.text})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-lg",children:j.icon}),e.jsx("span",{className:"text-gray-600",children:j.text})]}),t.photo_evidence&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(re,{className:"w-4 h-4 text-blue-600"}),e.jsx("a",{href:t.photo_evidence,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-blue-600 hover:text-blue-800",children:"Foto"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm",children:[e.jsx(ne,{className:"w-4 h-4 text-gray-600"}),e.jsxs("span",{className:"text-gray-600",children:["Operatore: ",t.recorded_by]})]}),t.notes&&e.jsxs("div",{className:"mt-2 p-2 bg-white bg-opacity-50 rounded text-sm",children:[e.jsx("strong",{children:"Note:"})," ",t.notes]})]}),t.status!=="compliant"&&e.jsx("div",{className:`mt-3 p-2 rounded border ${m.bg} ${m.border}`,children:e.jsxs("div",{className:"flex items-center space-x-2",children:[m.icon,e.jsx("span",{className:`text-sm font-medium ${m.color}`,children:t.status==="warning"?"Attenzione: Temperatura fuori dal range ottimale":"Critico: Intervento richiesto immediatamente"})]})})]})}function Me({task:t,status:d,onComplete:u,onEdit:a,onDelete:v,showActions:h=!0}){const g=K[t.type],l=J[d]||J.scheduled,m=c=>new Date(c).toLocaleDateString("it-IT",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"}),j=()=>{switch(t.frequency){case"daily":return"Giornaliera";case"weekly":return"Settimanale";case"monthly":return"Mensile";case"custom":return"Personalizzata";default:return t.frequency}},s=()=>{switch(d){case"overdue":return e.jsx(w,{className:"w-5 h-5 text-red-600"});case"pending":return e.jsx(k,{className:"w-5 h-5 text-yellow-600"});case"scheduled":return e.jsx(se,{className:"w-5 h-5 text-green-600"})}},x=()=>{switch(d){case"overdue":return"In Ritardo";case"pending":return"Urgente";case"scheduled":return"Programmata"}},b=d==="overdue",r=d==="pending";return e.jsxs("div",{className:`rounded-lg border-2 p-4 transition-all duration-200 hover:shadow-md ${l.bg} ${l.border}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"text-2xl",children:g.icon}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:g.label}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[e.jsxs("span",{children:["Frequenza: ",j()]}),e.jsx("span",{className:"mx-1",children:"•"}),e.jsxs("span",{children:[t.estimated_duration," min"]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[s(),h&&e.jsxs("div",{className:"flex items-center space-x-1",children:[!b&&e.jsx("button",{onClick:()=>u(t),className:"p-1 text-gray-600 hover:text-green-600 transition-colors",title:"Completa manutenzione",children:e.jsx(z,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>a(t),className:"p-1 text-gray-600 hover:text-blue-600 transition-colors",title:"Modifica task",children:e.jsx(G,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>v(t.id),className:"p-1 text-gray-600 hover:text-red-600 transition-colors",title:"Elimina task",children:e.jsx(L,{className:"w-4 h-4"})})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-600",children:"Stato"}),e.jsxs("div",{className:`font-semibold flex items-center space-x-1 ${l.text}`,children:[s(),e.jsx("span",{children:x()})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-600",children:"Prossima scadenza"}),e.jsx("div",{className:`font-semibold ${b||r?"text-red-600":"text-gray-900"}`,children:m(t.next_due)})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm mb-3",children:[e.jsx(ne,{className:"w-4 h-4 text-gray-600"}),e.jsxs("span",{className:"text-gray-600",children:["Assegnato a: ",e.jsx("strong",{children:t.assigned_to||"Non assegnato"})]}),t.assigned_to&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"mx-1 text-gray-400",children:"•"}),e.jsx("span",{className:"text-gray-500 capitalize",children:t.assigned_to})]})]}),t.checklist&&t.checklist.length>0&&e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"text-sm font-medium text-gray-700 mb-2",children:["Checklist (",t.checklist.length," elementi):"]}),e.jsxs("div",{className:"space-y-1",children:[t.checklist.slice(0,3).map((c,o)=>e.jsxs("div",{className:"flex items-start space-x-2 text-sm",children:[e.jsx("div",{className:"w-4 h-4 mt-0.5 rounded border border-gray-300 flex-shrink-0"}),e.jsx("span",{className:"text-gray-600 line-clamp-1",children:c})]},o)),t.checklist.length>3&&e.jsxs("div",{className:"text-xs text-gray-500 pl-6",children:["+",t.checklist.length-3," altri elementi..."]})]})]}),(b||r)&&e.jsx("div",{className:`mt-3 p-2 rounded border ${b?"bg-red-50 border-red-200":"bg-yellow-50 border-yellow-200"}`,children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(w,{className:`w-4 h-4 ${b?"text-red-600":"text-yellow-600"}`}),e.jsx("span",{className:`text-sm font-medium ${b?"text-red-800":"text-yellow-800"}`,children:b?"Manutenzione in ritardo - Intervento immediato richiesto":"Manutenzione urgente - Scadenza imminente"})]})}),b&&e.jsxs("button",{onClick:()=>u(t),className:"w-full mt-3 flex items-center justify-center space-x-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:[e.jsx(we,{className:"w-4 h-4"}),e.jsx("span",{children:"Completa Ora"})]})]})}function Ie(){const{conservationPoints:t,stats:d,isLoading:u,createConservationPoint:a,updateConservationPoint:v,deleteConservationPoint:h,isCreating:g,isUpdating:l,isDeleting:m}=ve(),[j,s]=N.useState(!1),[x,b]=N.useState(null),[r,c]=N.useState(!1),[o,p]=N.useState(null),[,I]=N.useState(null),{temperatureReadings:P,stats:E,isLoading:U,createReading:A,deleteReading:i,isCreating:f}=ze(),{maintenanceTasks:_,stats:C,isLoading:ie,getTaskStatus:Q,deleteTask:le,completeTask:ce}=Ne(),oe=(n,S=[])=>{x?v({id:x.id,data:n}):a({conservationPoint:n,maintenanceTasks:S}),s(!1),b(null)},de=n=>{b(n),s(!0)},me=n=>{confirm("Sei sicuro di voler eliminare questo punto di conservazione?")&&h(n)},V=()=>{b(null),s(!0)},Y=n=>{p(n),c(!0)},xe=n=>{A(n),c(!1),p(null)},ue=n=>{I(n),alert("Modifica lettura temperatura - Funzionalità in arrivo")},ge=n=>{confirm("Sei sicuro di voler eliminare questa lettura di temperatura?")&&i(n)},pe=n=>{confirm(`Sei sicuro di voler completare la manutenzione "${n.type}" per ${n.conservation_point?.name}?`)&&ce({maintenance_task_id:n.id,completed_by:"user1",completed_at:new Date,created_at:new Date,notes:"Completato tramite interfaccia web"})},he=n=>{alert("Modifica manutenzione - Funzionalità in arrivo")},be=n=>{confirm("Sei sicuro di voler eliminare questo task di manutenzione?")&&le(n)};return u?e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[1,2,3].map(n=>e.jsx("div",{className:"h-24 bg-gray-200 rounded"},n))}),e.jsx("div",{className:"h-64 bg-gray-200 rounded"})]})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Sistema di Conservazione"}),e.jsx("p",{className:"text-gray-600",children:"Gestisci punti di conservazione e monitoraggio temperature"})]})}),e.jsxs("div",{className:"bg-white rounded-lg border p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center",children:[e.jsx(Ce,{className:"w-5 h-5 mr-2 text-blue-600"}),"Distribuzione per Tipo"]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2 md:grid-cols-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl mb-1",children:"🌡️"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Ambiente"}),e.jsx("div",{className:"text-lg font-semibold",children:d.by_type.ambient??0})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl mb-1",children:"❄️"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Frigorifero"}),e.jsx("div",{className:"text-lg font-semibold",children:d.by_type.fridge??0})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl mb-1",children:"🧊"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Freezer"}),e.jsx("div",{className:"text-lg font-semibold",children:d.by_type.freezer??0})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl mb-1",children:"⚡"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Abbattitore"}),e.jsx("div",{className:"text-lg font-semibold",children:d.by_type.blast??0})]})]})]}),e.jsxs(B,{title:"Punti di Conservazione",subtitle:`${d.total_points} punti configurati`,defaultExpanded:!0,icon:R,actions:e.jsxs("button",{onClick:n=>{n.stopPropagation(),V()},className:"flex items-center space-x-1 px-3 py-1 text-sm bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:[e.jsx(q,{className:"w-4 h-4"}),e.jsx("span",{children:"Aggiungi"})]}),children:[e.jsxs("div",{className:"mb-6 grid grid-cols-1 gap-3 sm:grid-cols-2 md:grid-cols-4",children:[e.jsx("div",{className:"bg-blue-50 rounded-lg border border-blue-200 p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-blue-700",children:"Frigoriferi"}),e.jsx("p",{className:"text-lg font-bold text-blue-900",children:d.by_type.fridge??0})]}),e.jsx("div",{className:"text-xl",children:"❄️"})]})}),e.jsx("div",{className:"bg-cyan-50 rounded-lg border border-cyan-200 p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-cyan-700",children:"Freezer"}),e.jsx("p",{className:"text-lg font-bold text-cyan-900",children:d.by_type.freezer??0})]}),e.jsx("div",{className:"text-xl",children:"🧊"})]})}),e.jsx("div",{className:"bg-purple-50 rounded-lg border border-purple-200 p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-purple-700",children:"Abbattitore"}),e.jsx("p",{className:"text-lg font-bold text-purple-900",children:d.by_type.blast??0})]}),e.jsx("div",{className:"text-xl",children:"⚡"})]})}),e.jsx("div",{className:"bg-orange-50 rounded-lg border border-orange-200 p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-orange-700",children:"Dispensa"}),e.jsx("p",{className:"text-lg font-bold text-orange-900",children:d.by_type.ambient??0})]}),e.jsx("div",{className:"text-xl",children:"🌡️"})]})})]}),t.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(R,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Nessun punto di conservazione"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Inizia creando il primo punto di conservazione per il monitoraggio delle temperature."}),e.jsxs("button",{onClick:V,className:"flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors mx-auto",children:[e.jsx(q,{className:"w-5 h-5"}),e.jsx("span",{children:"Crea Primo Punto"})]})]}):e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:t.map(n=>e.jsx(Te,{point:n,onEdit:de,onDelete:me},n.id))})]}),e.jsxs(B,{title:"Letture Temperature",subtitle:`${E.total} letture registrate`,defaultExpanded:!0,icon:k,actions:e.jsx("div",{className:"flex items-center space-x-2",children:t.length>0&&e.jsxs("select",{onChange:n=>{const S=t.find($=>$.id===n.target.value);S&&(Y(S),n.target.value="")},onClick:n=>{n.stopPropagation()},onMouseDown:n=>{n.stopPropagation()},value:"",className:"flex items-center space-x-1 px-3 py-1 text-sm bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:[e.jsx("option",{value:"",children:"Registra temperatura..."}),t.map(n=>e.jsx("option",{value:n.id,children:n.name},n.id))]})}),children:[e.jsxs("div",{className:"mb-6 grid grid-cols-1 gap-3 sm:grid-cols-2 md:grid-cols-4",children:[e.jsx("div",{className:"bg-blue-50 rounded-lg border border-blue-200 p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-blue-700",children:"Totale"}),e.jsx("p",{className:"text-lg font-bold text-blue-900",children:E.total})]}),e.jsx(k,{className:"w-5 h-5 text-blue-600"})]})}),e.jsx("div",{className:"bg-green-50 rounded-lg border border-green-200 p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-green-700",children:"Conformi"}),e.jsx("p",{className:"text-lg font-bold text-green-900",children:E.compliant})]}),e.jsx(z,{className:"w-5 h-5 text-green-600"})]})}),e.jsx("div",{className:"bg-yellow-50 rounded-lg border border-yellow-200 p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-yellow-700",children:"Attenzione"}),e.jsx("p",{className:"text-lg font-bold text-yellow-900",children:E.warning})]}),e.jsx(w,{className:"w-5 h-5 text-yellow-600"})]})}),e.jsx("div",{className:"bg-red-50 rounded-lg border border-red-200 p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-red-700",children:"Critiche"}),e.jsx("p",{className:"text-lg font-bold text-red-900",children:E.critical})]}),e.jsx(w,{className:"w-5 h-5 text-red-600"})]})})]}),U?e.jsx("div",{className:"animate-pulse space-y-4",children:[1,2,3].map(n=>e.jsx("div",{className:"h-32 bg-gray-200 rounded"},n))}):P.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(k,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Nessuna lettura di temperatura"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Inizia registrando la prima lettura di temperatura per un punto di conservazione."}),t.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Seleziona un punto di conservazione:"}),e.jsx("div",{className:"flex flex-wrap gap-2 justify-center",children:t.map(n=>e.jsxs("button",{onClick:()=>Y(n),className:"flex items-center space-x-2 px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(R,{className:"w-4 h-4"}),e.jsx("span",{children:n.name})]},n.id))})]})]}):e.jsx("div",{className:"space-y-4",children:P.sort((n,S)=>new Date(S.recorded_at).getTime()-new Date(n.recorded_at).getTime()).map(n=>e.jsx($e,{reading:n,onEdit:ue,onDelete:ge},n.id))})]}),e.jsxs(B,{title:"Manutenzioni Programmate",subtitle:`${C.total_tasks} task configurati`,defaultExpanded:!0,icon:F,actions:e.jsxs("button",{onClick:n=>{n.stopPropagation(),alert("Aggiungi manutenzione - Funzionalità in arrivo")},className:"flex items-center space-x-1 px-3 py-1 text-sm bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:[e.jsx(q,{className:"w-4 h-4"}),e.jsx("span",{children:"Aggiungi"})]}),children:[e.jsxs("div",{className:"mb-6 grid grid-cols-1 gap-3 sm:grid-cols-2 md:grid-cols-4",children:[e.jsx("div",{className:"bg-blue-50 rounded-lg border border-blue-200 p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-blue-700",children:"Totale"}),e.jsx("p",{className:"text-lg font-bold text-blue-900",children:C.total_tasks})]}),e.jsx(F,{className:"w-5 h-5 text-blue-600"})]})}),e.jsx("div",{className:"bg-red-50 rounded-lg border border-red-200 p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-red-700",children:"In Ritardo"}),e.jsx("p",{className:"text-lg font-bold text-red-900",children:C.overdue_tasks})]}),e.jsx(w,{className:"w-5 h-5 text-red-600"})]})}),e.jsx("div",{className:"bg-yellow-50 rounded-lg border border-yellow-200 p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-yellow-700",children:"Urgenti"}),e.jsx("p",{className:"text-lg font-bold text-yellow-900",children:Math.max(C.total_tasks-C.overdue_tasks,0)})]}),e.jsx(k,{className:"w-5 h-5 text-yellow-600"})]})}),e.jsx("div",{className:"bg-green-50 rounded-lg border border-green-200 p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-green-700",children:"Programmate"}),e.jsx("p",{className:"text-lg font-bold text-green-900",children:C.completed_tasks})]}),e.jsx(z,{className:"w-5 h-5 text-green-600"})]})})]}),e.jsxs("div",{className:"mb-6 bg-gray-50 rounded-lg p-4",children:[e.jsxs("h4",{className:"text-sm font-semibold mb-3 flex items-center text-gray-700",children:[e.jsx(F,{className:"w-4 h-4 mr-2 text-blue-600"}),"Distribuzione per Tipo"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg mb-1",children:"🌡️"}),e.jsx("div",{className:"text-xs text-gray-600",children:"Controllo Temperature"}),e.jsx("div",{className:"text-sm font-semibold",children:C.tasks_by_type.temperature_calibration??0})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg mb-1",children:"🧼"}),e.jsx("div",{className:"text-xs text-gray-600",children:"Pulizia Profonda"}),e.jsx("div",{className:"text-sm font-semibold",children:C.tasks_by_type.deep_cleaning??0})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg mb-1",children:"❄️"}),e.jsx("div",{className:"text-xs text-gray-600",children:"Sbrinamento"}),e.jsx("div",{className:"text-sm font-semibold",children:C.tasks_by_type.defrosting??0})]})]})]}),ie?e.jsx("div",{className:"animate-pulse space-y-4",children:[1,2,3].map(n=>e.jsx("div",{className:"h-32 bg-gray-200 rounded"},n))}):_.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(F,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Nessuna manutenzione programmata"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Le manutenzioni vengono create automaticamente per ogni punto di conservazione."})]}):e.jsx("div",{className:"space-y-4",children:_.sort((n,S)=>{const $={overdue:0,pending:1,scheduled:2},W=Q(n),H=Q(S);return $[W]!==$[H]?$[W]-$[H]:new Date(n.next_due).getTime()-new Date(S.next_due).getTime()}).map(n=>e.jsx(Me,{task:n,status:Q(n),onComplete:pe,onEdit:he,onDelete:be},n.id))})]}),e.jsx(Ee,{isOpen:j,onClose:()=>{s(!1),b(null)},onSave:oe,point:x,isLoading:g||l}),o&&e.jsx(Ae,{isOpen:r,onClose:()=>{c(!1),p(null)},onSave:xe,conservationPoint:o,isLoading:f}),m&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25 flex items-center justify-center z-40",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 flex items-center space-x-3",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"}),e.jsx("span",{children:"Eliminando..."})]})})]})}const Le=Object.freeze(Object.defineProperty({__proto__:null,default:Ie},Symbol.toStringTag,{value:"Module"}));export{Le as C,Se as u};
