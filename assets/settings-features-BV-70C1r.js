import{a as D,u as I,b as z,j as e}from"./query-vendor-BsnDS19Y.js";import{u as E,s as N,C as P}from"./calendar-features-DOX2NwpL.js";import{r as b}from"./react-vendor-Cttizgra.js";import{c as H,u as M,K as T,M as O,z as U,y as G,H as $,S as B,X as K,f as V,L as X,G as k,e as q,o as J,d as Q,N as R,O as W,Q as Y}from"./ui-vendor-BFMCvSnM.js";import"./calendar-vendor-CzJ7rMdU.js";import"./auth-vendor-CMFeYHy6.js";import"./inventory-features-tEOlqD7s.js";function Z(){const{companyId:l}=E(),g=D(),[n,u]=b.useState(!1),[o,x]=b.useState({}),[r,h]=b.useState({}),{data:i,isLoading:y,error:_}=I({queryKey:["company",l],queryFn:async()=>{if(!l)return null;const{data:a,error:c}=await N.from("companies").select("*").eq("id",l).single();if(c)throw c;return a},enabled:!!l}),j=z({mutationFn:async a=>{if(!l)throw new Error("Company ID not found");const{error:c}=await N.from("companies").update({...a,updated_at:new Date().toISOString()}).eq("id",l);if(c)throw c},onSuccess:()=>{g.invalidateQueries({queryKey:["company",l]}),u(!1),h({})},onError:a=>{console.error("Error updating company:",a),h({general:"Errore durante il salvataggio delle modifiche"})}});b.useEffect(()=>{i&&x({name:i.name||"",address:i.address||"",phone:i.phone||"",email:i.email||"",vat_number:i.vat_number||"",business_type:i.business_type||"",established_date:i.established_date||"",license_number:i.license_number||""})},[i]);const m=(a,c)=>{x(s=>({...s,[a]:c})),r[a]&&h(s=>({...s,[a]:""}))},f=()=>{const a={};return o.name?.trim()||(a.name="Il nome dell'azienda è obbligatorio"),o.address?.trim()||(a.address="L'indirizzo è obbligatorio"),o.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(o.email)&&(a.email="Inserisci un indirizzo email valido"),o.phone&&!/^[+]?[0-9\s\-()]+$/.test(o.phone)&&(a.phone="Inserisci un numero di telefono valido"),h(a),Object.keys(a).length===0},w=async()=>{if(f())try{await j.mutateAsync(o)}catch(a){console.error("Save failed:",a)}},C=()=>{i&&x({name:i.name||"",address:i.address||"",phone:i.phone||"",email:i.email||"",vat_number:i.vat_number||"",business_type:i.business_type||"",established_date:i.established_date||"",license_number:i.license_number||""}),u(!1),h({})};return y?e.jsx("div",{className:"animate-pulse",children:e.jsx("div",{className:"space-y-4",children:[1,2,3,4].map(a=>e.jsx("div",{className:"h-16 bg-gray-200 rounded"},a))})}):_?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(H,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Errore nel caricamento"}),e.jsx("p",{className:"text-gray-600",children:"Non è stato possibile caricare i dati dell'azienda."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(M,{className:"w-6 h-6 text-blue-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Informazioni Aziendali"})]}),e.jsx("div",{className:"flex gap-2",children:n?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:C,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 border border-gray-300 rounded-md hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-500",children:"Annulla"}),e.jsx("button",{onClick:w,disabled:j.isPending,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:j.isPending?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Salvataggio..."]}):e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"w-4 h-4"}),"Salva"]})})]}):e.jsx("button",{onClick:()=>u(!0),className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500",children:"Modifica"})})]}),r.general&&e.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-md",children:e.jsxs("div",{className:"flex",children:[e.jsx(H,{className:"w-5 h-5 text-red-400"}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm text-red-800",children:r.general})})]})}),e.jsxs("div",{className:"grid grid-cols-1 gap-5 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nome Azienda *"}),n?e.jsx("input",{type:"text",value:o.name||"",onChange:a=>m("name",a.target.value),className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${r.name?"border-red-300":"border-gray-300"}`,placeholder:"Inserisci il nome dell'azienda"}):e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-gray-50 border border-gray-200 rounded-md",children:[e.jsx(M,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-gray-900",children:i?.name||"Non specificato"})]}),r.name&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tipo di Attività"}),n?e.jsxs("select",{value:o.business_type||"",onChange:a=>m("business_type",a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Seleziona tipo di attività"}),e.jsx("option",{value:"ristorante",children:"Ristorante"}),e.jsx("option",{value:"bar",children:"Bar"}),e.jsx("option",{value:"pizzeria",children:"Pizzeria"}),e.jsx("option",{value:"trattoria",children:"Trattoria"}),e.jsx("option",{value:"osteria",children:"Osteria"}),e.jsx("option",{value:"enoteca",children:"Enoteca"}),e.jsx("option",{value:"birreria",children:"Birreria"}),e.jsx("option",{value:"altro",children:"Altro"})]}):e.jsx("div",{className:"p-3 bg-gray-50 border border-gray-200 rounded-md",children:e.jsx("span",{className:"text-gray-900",children:i?.business_type||"Non specificato"})})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Indirizzo *"}),n?e.jsx("textarea",{value:o.address||"",onChange:a=>m("address",a.target.value),rows:3,className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${r.address?"border-red-300":"border-gray-300"}`,placeholder:"Inserisci l'indirizzo completo"}):e.jsxs("div",{className:"flex items-start gap-2 p-3 bg-gray-50 border border-gray-200 rounded-md",children:[e.jsx(O,{className:"w-4 h-4 text-gray-500 mt-0.5"}),e.jsx("span",{className:"text-gray-900",children:i?.address||"Non specificato"})]}),r.address&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.address})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Telefono"}),n?e.jsx("input",{type:"tel",value:o.phone||"",onChange:a=>m("phone",a.target.value),className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${r.phone?"border-red-300":"border-gray-300"}`,placeholder:"+39 051 1234567"}):e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-gray-50 border border-gray-200 rounded-md",children:[e.jsx(U,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-gray-900",children:i?.phone||"Non specificato"})]}),r.phone&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.phone})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email"}),n?e.jsx("input",{type:"email",value:o.email||"",onChange:a=>m("email",a.target.value),className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${r.email?"border-red-300":"border-gray-300"}`,placeholder:"info@azienda.it"}):e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-gray-50 border border-gray-200 rounded-md",children:[e.jsx(G,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-gray-900",children:i?.email||"Non specificato"})]}),r.email&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.email})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Partita IVA"}),n?e.jsx("input",{type:"text",value:o.vat_number||"",onChange:a=>m("vat_number",a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"IT12345678901"}):e.jsx("div",{className:"p-3 bg-gray-50 border border-gray-200 rounded-md",children:e.jsx("span",{className:"text-gray-900",children:i?.vat_number||"Non specificato"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Numero Licenza"}),n?e.jsx("input",{type:"text",value:o.license_number||"",onChange:a=>m("license_number",a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"LIC-2024-001"}):e.jsx("div",{className:"p-3 bg-gray-50 border border-gray-200 rounded-md",children:e.jsx("span",{className:"text-gray-900",children:i?.license_number||"Non specificato"})})]})]}),j.isSuccess&&e.jsx("div",{className:"p-4 bg-green-50 border border-green-200 rounded-md",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"w-5 h-5 text-green-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm text-green-800",children:"Informazioni aziendali aggiornate con successo."})})]})})]})}function ee(){const{companyId:l}=E(),g=D(),[n,u]=b.useState(null),[o,x]=b.useState({}),{data:r,isLoading:h}=I({queryKey:["user-profiles",l],queryFn:async()=>{if(!l)return[];const{data:s,error:t}=await N.from("user_profiles").select(`
          *,
          staff:staff_id (
            id,
            name,
            role,
            category,
            email,
            phone,
            hire_date,
            status,
            haccp_certification,
            department_assignments
          )
        `).eq("company_id",l);if(t)throw t;return s},enabled:!!l}),{data:i,isLoading:y}=I({queryKey:["staff",l],queryFn:async()=>{if(!l)return[];const{data:s,error:t}=await N.from("staff").select("*").eq("company_id",l).eq("status","active");if(t)throw t;return s},enabled:!!l}),_=z({mutationFn:async({userId:s,newRole:t})=>{const{error:d}=await N.from("user_profiles").update({role:t}).eq("id",s);if(d)throw d},onSuccess:()=>{g.invalidateQueries({queryKey:["user-profiles",l]}),u(null)}}),j=z({mutationFn:async({userId:s,staffId:t})=>{const{error:d}=await N.from("user_profiles").update({staff_id:t}).eq("id",s);if(d)throw d},onSuccess:()=>{g.invalidateQueries({queryKey:["user-profiles",l]})}}),m=z({mutationFn:async s=>{const{error:t}=await N.from("user_profiles").update({staff_id:null}).eq("id",s);if(t)throw t},onSuccess:()=>{g.invalidateQueries({queryKey:["user-profiles",l]})}}),f=(s,t)=>{_.mutate({userId:s,newRole:t})},w=(s,t)=>{j.mutate({userId:s,staffId:t})},C=s=>{m.mutate(s)},a=s=>{switch(s){case"admin":return"bg-red-100 text-red-800 border-red-200";case"responsabile":return"bg-blue-100 text-blue-800 border-blue-200";case"dipendente":return"bg-green-100 text-green-800 border-green-200";case"collaboratore":return"bg-yellow-100 text-yellow-800 border-yellow-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},c=s=>{switch(s){case"admin":return"Amministratore";case"responsabile":return"Responsabile";case"dipendente":return"Dipendente";case"collaboratore":return"Collaboratore";default:return"Guest"}};return h||y?e.jsx("div",{className:"animate-pulse",children:e.jsx("div",{className:"space-y-4",children:[1,2,3].map(s=>e.jsx("div",{className:"h-20 bg-gray-200 rounded"},s))})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx($,{className:"w-6 h-6 text-blue-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Gestione Utenti e Ruoli"})]}),e.jsxs("div",{className:"text-sm text-gray-500",children:[r?.length||0," utenti registrati"]})]}),e.jsx("div",{className:"space-y-4",children:r?.map(s=>e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx($,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:s.staff?.name||"Utente non collegato"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["ID: ",s.id]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2 lg:grid-cols-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Ruolo Sistema"}),n===s.id?e.jsxs("select",{value:s.role,onChange:t=>f(s.id,t.target.value),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"admin",children:"Amministratore"}),e.jsx("option",{value:"responsabile",children:"Responsabile"}),e.jsx("option",{value:"dipendente",children:"Dipendente"}),e.jsx("option",{value:"collaboratore",children:"Collaboratore"}),e.jsx("option",{value:"guest",children:"Guest"})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ${a(s.role)}`,children:c(s.role)}),e.jsx("button",{onClick:()=>u(s.id),className:"p-1 text-gray-400 hover:text-gray-600",children:e.jsx(B,{className:"w-3 h-3"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Collegamento Staff"}),s.staff?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-green-600 font-medium",children:"✓ Collegato"}),e.jsx("button",{onClick:()=>C(s.id),className:"p-1 text-red-400 hover:text-red-600",title:"Rimuovi collegamento",children:e.jsx(K,{className:"w-3 h-3"})})]}):e.jsxs("select",{value:o[s.id]||"",onChange:t=>x(d=>({...d,[s.id]:t.target.value})),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Seleziona staff..."}),i?.filter(t=>t.email).map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",t.email,")"]},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Contatto"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[s.staff?.email&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(G,{className:"w-3 h-3"}),e.jsx("span",{children:s.staff.email})]}),s.staff?.phone&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(U,{className:"w-3 h-3"}),e.jsx("span",{children:s.staff.phone})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Registrato"}),e.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-600",children:[e.jsx(V,{className:"w-3 h-3"}),e.jsx("span",{children:new Date(s.created_at).toLocaleDateString("it-IT")})]})]})]}),s.staff&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-3",children:[e.jsx("h5",{className:"font-medium text-gray-900 mb-2",children:"Dettagli Staff"}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 text-sm sm:grid-cols-2 lg:grid-cols-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Categoria:"}),e.jsx("p",{className:"font-medium",children:s.staff.category})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Ruolo Staff:"}),e.jsx("p",{className:"font-medium",children:s.staff.role})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Stato:"}),e.jsx("p",{className:"font-medium",children:s.staff.status})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Assunto:"}),e.jsx("p",{className:"font-medium",children:s.staff.hire_date?new Date(s.staff.hire_date).toLocaleDateString("it-IT"):"N/A"})]})]})]})]}),e.jsxs("div",{className:"flex flex-col gap-2 ml-4",children:[!s.staff&&o[s.id]&&e.jsxs("button",{onClick:()=>w(s.id,o[s.id]),className:"px-3 py-1 text-xs font-medium text-blue-600 bg-blue-100 border border-blue-200 rounded-md hover:bg-blue-200 flex items-center gap-1",children:[e.jsx(X,{className:"w-3 h-3"}),"Collegare"]}),n===s.id&&e.jsxs("button",{onClick:()=>u(null),className:"px-3 py-1 text-xs font-medium text-gray-600 bg-gray-100 border border-gray-200 rounded-md hover:bg-gray-200 flex items-center gap-1",children:[e.jsx(K,{className:"w-3 h-3"}),"Annulla"]})]})]})},s.id))}),r&&r.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx($,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Nessun utente trovato"}),e.jsx("p",{className:"text-gray-600",children:"Non ci sono utenti registrati per questa azienda."})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx(k,{className:"w-5 h-5 text-blue-600 mt-0.5"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-1",children:"Gestione Ruoli e Permessi"}),e.jsxs("div",{className:"text-sm text-blue-800 space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Amministratore:"})," Accesso completo a tutte le funzionalità"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Responsabile:"})," Gestione staff, dipartimenti e conservazione"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Dipendente:"})," Accesso limitato a funzionalità operative"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Collaboratore:"})," Accesso in sola lettura"]})]})]})]})})]})}const L={temperature_thresholds:{fridge_min:0,fridge_max:4,freezer_min:-18,freezer_max:-15,ambient_min:10,ambient_max:25,blast_min:-25,blast_max:-15},alert_settings:{expiry_days:3,certification_expiry_days:30,temperature_violation_immediate:!0,maintenance_overdue_days:1},compliance_settings:{required_documentation:["temperature_logs","maintenance_records","staff_certifications"],audit_frequency_days:365,corrective_action_required:!0,preventive_action_required:!0}};function se(){const{companyId:l}=E(),g=D(),[n,u]=b.useState(!1),[o,x]=b.useState(L),[r,h]=b.useState({}),{data:i,isLoading:y,error:_}=I({queryKey:["haccp-config",l],queryFn:async()=>{if(!l)return null;const{data:a,error:c}=await N.from("haccp_configurations").select("*").eq("company_id",l).single();if(c&&c.code!=="PGRST116")throw c;return a},enabled:!!l}),j=z({mutationFn:async a=>{if(!l)throw new Error("Company ID not found");const c={...a,company_id:l,updated_at:new Date().toISOString()};if(i){const{error:s}=await N.from("haccp_configurations").update(c).eq("id",i.id);if(s)throw s}else{const{error:s}=await N.from("haccp_configurations").insert([c]);if(s)throw s}},onSuccess:()=>{g.invalidateQueries({queryKey:["haccp-config",l]}),u(!1),h({})},onError:a=>{console.error("Error saving HACCP config:",a),h({general:"Errore durante il salvataggio della configurazione"})}});b.useEffect(()=>{x(i||L)},[i]);const m=(a,c)=>{const s=a.split(".");x(t=>{const d={...t};let p=d;for(let v=0;v<s.length-1;v++)p[s[v]]||(p[s[v]]={}),p=p[s[v]];return p[s[s.length-1]]=c,d}),r[a]&&h(t=>({...t,[a]:""}))},f=()=>{const a={},c=o.temperature_thresholds;c&&(c.fridge_min>=c.fridge_max&&(a["temperature_thresholds.fridge"]="La temperatura minima deve essere inferiore alla massima"),c.freezer_min>=c.freezer_max&&(a["temperature_thresholds.freezer"]="La temperatura minima deve essere inferiore alla massima"),c.ambient_min>=c.ambient_max&&(a["temperature_thresholds.ambient"]="La temperatura minima deve essere inferiore alla massima"),c.blast_min>=c.blast_max&&(a["temperature_thresholds.blast"]="La temperatura minima deve essere inferiore alla massima"));const s=o.alert_settings;return s&&((s.expiry_days<0||s.expiry_days>30)&&(a["alert_settings.expiry_days"]="I giorni di preavviso scadenza devono essere tra 0 e 30"),(s.certification_expiry_days<0||s.certification_expiry_days>90)&&(a["alert_settings.certification_expiry_days"]="I giorni di preavviso certificazione devono essere tra 0 e 90")),h(a),Object.keys(a).length===0},w=async()=>{if(f())try{await j.mutateAsync(o)}catch(a){console.error("Save failed:",a)}},C=()=>{x(i||L),u(!1),h({})};return y?e.jsx("div",{className:"animate-pulse",children:e.jsx("div",{className:"space-y-4",children:[1,2,3].map(a=>e.jsx("div",{className:"h-32 bg-gray-200 rounded"},a))})}):_?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(q,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Errore nel caricamento"}),e.jsx("p",{className:"text-gray-600",children:"Non è stato possibile caricare la configurazione HACCP."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{className:"w-6 h-6 text-blue-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Configurazione HACCP"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:n?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:C,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 border border-gray-300 rounded-md hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-500",children:"Annulla"}),e.jsx("button",{onClick:w,disabled:j.isPending,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:j.isPending?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Salvataggio..."]}):e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"w-4 h-4"}),"Salva"]})})]}):e.jsx("button",{onClick:()=>u(!0),className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500",children:"Modifica"})})]}),r.general&&e.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-md",children:e.jsxs("div",{className:"flex",children:[e.jsx(q,{className:"w-5 h-5 text-red-400"}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm text-red-800",children:r.general})})]})}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 sm:p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(J,{className:"w-5 h-5 text-blue-600"}),e.jsx("h4",{className:"font-medium text-gray-900",children:"Soglie di Temperatura"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Frigorifero (°C)"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{children:e.jsx("input",{type:"number",step:"0.1",value:o.temperature_thresholds?.fridge_min||"",onChange:a=>m("temperature_thresholds.fridge_min",parseFloat(a.target.value)||0),disabled:!n,className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${r["temperature_thresholds.fridge"]?"border-red-300":"border-gray-300"} ${n?"":"bg-gray-50"}`,placeholder:"Min"})}),e.jsx("div",{children:e.jsx("input",{type:"number",step:"0.1",value:o.temperature_thresholds?.fridge_max||"",onChange:a=>m("temperature_thresholds.fridge_max",parseFloat(a.target.value)||0),disabled:!n,className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${r["temperature_thresholds.fridge"]?"border-red-300":"border-gray-300"} ${n?"":"bg-gray-50"}`,placeholder:"Max"})})]}),r["temperature_thresholds.fridge"]&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r["temperature_thresholds.fridge"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Congelatore (°C)"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{children:e.jsx("input",{type:"number",step:"0.1",value:o.temperature_thresholds?.freezer_min||"",onChange:a=>m("temperature_thresholds.freezer_min",parseFloat(a.target.value)||0),disabled:!n,className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${r["temperature_thresholds.freezer"]?"border-red-300":"border-gray-300"} ${n?"":"bg-gray-50"}`,placeholder:"Min"})}),e.jsx("div",{children:e.jsx("input",{type:"number",step:"0.1",value:o.temperature_thresholds?.freezer_max||"",onChange:a=>m("temperature_thresholds.freezer_max",parseFloat(a.target.value)||0),disabled:!n,className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${r["temperature_thresholds.freezer"]?"border-red-300":"border-gray-300"} ${n?"":"bg-gray-50"}`,placeholder:"Max"})})]}),r["temperature_thresholds.freezer"]&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r["temperature_thresholds.freezer"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Ambiente (°C)"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{children:e.jsx("input",{type:"number",step:"0.1",value:o.temperature_thresholds?.ambient_min||"",onChange:a=>m("temperature_thresholds.ambient_min",parseFloat(a.target.value)||0),disabled:!n,className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${r["temperature_thresholds.ambient"]?"border-red-300":"border-gray-300"} ${n?"":"bg-gray-50"}`,placeholder:"Min"})}),e.jsx("div",{children:e.jsx("input",{type:"number",step:"0.1",value:o.temperature_thresholds?.ambient_max||"",onChange:a=>m("temperature_thresholds.ambient_max",parseFloat(a.target.value)||0),disabled:!n,className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${r["temperature_thresholds.ambient"]?"border-red-300":"border-gray-300"} ${n?"":"bg-gray-50"}`,placeholder:"Max"})})]}),r["temperature_thresholds.ambient"]&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r["temperature_thresholds.ambient"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Blast Chiller (°C)"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{children:e.jsx("input",{type:"number",step:"0.1",value:o.temperature_thresholds?.blast_min||"",onChange:a=>m("temperature_thresholds.blast_min",parseFloat(a.target.value)||0),disabled:!n,className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${r["temperature_thresholds.blast"]?"border-red-300":"border-gray-300"} ${n?"":"bg-gray-50"}`,placeholder:"Min"})}),e.jsx("div",{children:e.jsx("input",{type:"number",step:"0.1",value:o.temperature_thresholds?.blast_max||"",onChange:a=>m("temperature_thresholds.blast_max",parseFloat(a.target.value)||0),disabled:!n,className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${r["temperature_thresholds.blast"]?"border-red-300":"border-gray-300"} ${n?"":"bg-gray-50"}`,placeholder:"Max"})})]}),r["temperature_thresholds.blast"]&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r["temperature_thresholds.blast"]})]})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 sm:p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(q,{className:"w-5 h-5 text-orange-600"}),e.jsx("h4",{className:"font-medium text-gray-900",children:"Impostazioni Allerte"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Giorni preavviso scadenza prodotti"}),e.jsx("input",{type:"number",min:"0",max:"30",value:o.alert_settings?.expiry_days||"",onChange:a=>m("alert_settings.expiry_days",parseInt(a.target.value)||0),disabled:!n,className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${r["alert_settings.expiry_days"]?"border-red-300":"border-gray-300"} ${n?"":"bg-gray-50"}`}),r["alert_settings.expiry_days"]&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r["alert_settings.expiry_days"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Giorni preavviso scadenza certificazioni"}),e.jsx("input",{type:"number",min:"0",max:"90",value:o.alert_settings?.certification_expiry_days||"",onChange:a=>m("alert_settings.certification_expiry_days",parseInt(a.target.value)||0),disabled:!n,className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${r["alert_settings.certification_expiry_days"]?"border-red-300":"border-gray-300"} ${n?"":"bg-gray-50"}`}),r["alert_settings.certification_expiry_days"]&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r["alert_settings.certification_expiry_days"]})]}),e.jsx("div",{className:"md:col-span-2",children:e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:o.alert_settings?.temperature_violation_immediate||!1,onChange:a=>m("alert_settings.temperature_violation_immediate",a.target.checked),disabled:!n,className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Allerta immediata per violazioni di temperatura"})]})})]})]}),j.isSuccess&&e.jsx("div",{className:"p-4 bg-green-50 border border-green-200 rounded-md",children:e.jsxs("div",{className:"flex",children:[e.jsx(Q,{className:"w-5 h-5 text-green-400"}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm text-green-800",children:"Configurazione HACCP salvata con successo."})})]})}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx(k,{className:"w-5 h-5 text-blue-600 mt-0.5"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-1",children:"Conformità HACCP"}),e.jsx("p",{className:"text-sm text-blue-800",children:"Queste impostazioni determinano le soglie di allerta e i parametri di conformità per il sistema HACCP. Le modifiche vengono applicate immediatamente a tutti i controlli di temperatura e alle procedure di monitoraggio."})]})]})})]})}const F={email_notifications:{temperature_violations:!0,expiry_alerts:!0,maintenance_reminders:!0,certification_expiry:!0,system_updates:!1,daily_summary:!0,weekly_report:!0},push_notifications:{temperature_violations:!0,expiry_alerts:!0,maintenance_reminders:!1,certification_expiry:!0,urgent_alerts:!0},notification_frequency:{email_digest:"daily",push_frequency:"immediate",quiet_hours_start:"22:00",quiet_hours_end:"07:00",weekend_notifications:!1},alert_preferences:{critical_alerts_only:!1,include_photos:!0,include_location:!0,escalation_enabled:!0}};function ae(){const{companyId:l,userId:g}=E(),n=D(),[u,o]=b.useState(!1),[x,r]=b.useState(F),[h,i]=b.useState({}),{data:y,isLoading:_,error:j}=I({queryKey:["notification-config",l,g],queryFn:async()=>{if(!l||!g)return null;const{data:s,error:t}=await N.from("notification_preferences").select("*").eq("company_id",l).eq("user_id",g).single();if(t&&t.code!=="PGRST116")throw t;return s},enabled:!!l&&!!g}),m=z({mutationFn:async s=>{if(!l||!g)throw new Error("Company ID or User ID not found");const t={...s,company_id:l,user_id:g,updated_at:new Date().toISOString()};if(y){const{error:d}=await N.from("notification_preferences").update(t).eq("id",y.id);if(d)throw d}else{const{error:d}=await N.from("notification_preferences").insert([t]);if(d)throw d}},onSuccess:()=>{n.invalidateQueries({queryKey:["notification-config",l,g]}),o(!1),i({})},onError:s=>{console.error("Error saving notification config:",s),i({general:"Errore durante il salvataggio delle preferenze"})}});b.useEffect(()=>{r(y||F)},[y]);const f=(s,t)=>{const d=s.split(".");r(p=>{const v={...p};let S=v;for(let A=0;A<d.length-1;A++)S[d[A]]||(S[d[A]]={}),S=S[d[A]];return S[d[d.length-1]]=t,v}),h[s]&&i(p=>({...p,[s]:""}))},w=()=>{const s={},t=x.notification_frequency?.quiet_hours_start,d=x.notification_frequency?.quiet_hours_end;if(t&&d){const p=new Date(`2000-01-01 ${t}`),v=new Date(`2000-01-01 ${d}`);p>=v&&(s["notification_frequency.quiet_hours"]="L'ora di inizio deve essere precedente all'ora di fine")}return i(s),Object.keys(s).length===0},C=async()=>{if(w())try{await m.mutateAsync(x)}catch(s){console.error("Save failed:",s)}},a=()=>{r(y||F),o(!1),i({})},c=()=>{r(F)};return _?e.jsx("div",{className:"animate-pulse",children:e.jsx("div",{className:"space-y-4",children:[1,2,3].map(s=>e.jsx("div",{className:"h-32 bg-gray-200 rounded"},s))})}):j?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(q,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Errore nel caricamento"}),e.jsx("p",{className:"text-gray-600",children:"Non è stato possibile caricare le preferenze di notifica."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(R,{className:"w-6 h-6 text-blue-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Preferenze Notifiche"})]}),e.jsx("div",{className:"flex gap-2",children:u?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:c,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 border border-gray-300 rounded-md hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-500",children:"Reset"}),e.jsx("button",{onClick:a,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 border border-gray-300 rounded-md hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-500",children:"Annulla"}),e.jsx("button",{onClick:C,disabled:m.isPending,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:m.isPending?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Salvataggio..."]}):e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"w-4 h-4"}),"Salva"]})})]}):e.jsx("button",{onClick:()=>o(!0),className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500",children:"Modifica"})})]}),h.general&&e.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-md",children:e.jsxs("div",{className:"flex",children:[e.jsx(q,{className:"w-5 h-5 text-red-400"}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm text-red-800",children:h.general})})]})}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 sm:p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(G,{className:"w-5 h-5 text-blue-600"}),e.jsx("h4",{className:"font-medium text-gray-900",children:"Notifiche Email"})]}),e.jsx("div",{className:"space-y-3 sm:space-y-4",children:[{key:"temperature_violations",label:"Violazioni di temperatura",description:"Ricevi email quando vengono rilevate temperature fuori range"},{key:"expiry_alerts",label:"Allerte scadenza",description:"Notifiche per prodotti in scadenza"},{key:"maintenance_reminders",label:"Promemoria manutenzione",description:"Ricordi per task di manutenzione programmati"},{key:"certification_expiry",label:"Scadenza certificazioni",description:"Avvisi per certificazioni HACCP in scadenza"},{key:"system_updates",label:"Aggiornamenti sistema",description:"Notifiche per aggiornamenti e nuove funzionalità"},{key:"daily_summary",label:"Riepilogo giornaliero",description:"Sintesi delle attività della giornata"},{key:"weekly_report",label:"Report settimanale",description:"Rapporto settimanale delle performance"}].map(({key:s,label:t,description:d})=>e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("input",{type:"checkbox",checked:x.email_notifications?.[s]||!1,onChange:p=>f(`email_notifications.${s}`,p.target.checked),disabled:!u,className:"mt-1 rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-sm font-medium text-gray-900",children:t}),e.jsx("p",{className:"text-sm text-gray-500",children:d})]})]},s))})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 sm:p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(W,{className:"w-5 h-5 text-green-600"}),e.jsx("h4",{className:"font-medium text-gray-900",children:"Notifiche Push"})]}),e.jsx("div",{className:"space-y-3 sm:space-y-4",children:[{key:"temperature_violations",label:"Violazioni di temperatura",description:"Notifiche immediate per temperature critiche"},{key:"expiry_alerts",label:"Allerte scadenza",description:"Push per prodotti in scadenza"},{key:"maintenance_reminders",label:"Promemoria manutenzione",description:"Ricordi per task di manutenzione"},{key:"certification_expiry",label:"Scadenza certificazioni",description:"Avvisi certificazioni HACCP"},{key:"urgent_alerts",label:"Allerte urgenti",description:"Notifiche per situazioni critiche"}].map(({key:s,label:t,description:d})=>e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("input",{type:"checkbox",checked:x.push_notifications?.[s]||!1,onChange:p=>f(`push_notifications.${s}`,p.target.checked),disabled:!u,className:"mt-1 rounded border-gray-300 text-green-600 focus:ring-green-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-sm font-medium text-gray-900",children:t}),e.jsx("p",{className:"text-sm text-gray-500",children:d})]})]},s))})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 sm:p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(R,{className:"w-5 h-5 text-purple-600"}),e.jsx("h4",{className:"font-medium text-gray-900",children:"Frequenza Notifiche"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Digest Email"}),e.jsxs("select",{value:x.notification_frequency?.email_digest||"daily",onChange:s=>f("notification_frequency.email_digest",s.target.value),disabled:!u,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"immediate",children:"Immediato"}),e.jsx("option",{value:"hourly",children:"Ogni ora"}),e.jsx("option",{value:"daily",children:"Giornaliero"}),e.jsx("option",{value:"weekly",children:"Settimanale"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Frequenza Push"}),e.jsxs("select",{value:x.notification_frequency?.push_frequency||"immediate",onChange:s=>f("notification_frequency.push_frequency",s.target.value),disabled:!u,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"immediate",children:"Immediato"}),e.jsx("option",{value:"batched",children:"Raggruppato"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Inizio ore silenziose"}),e.jsx("input",{type:"time",value:x.notification_frequency?.quiet_hours_start||"22:00",onChange:s=>f("notification_frequency.quiet_hours_start",s.target.value),disabled:!u,className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${h["notification_frequency.quiet_hours"]?"border-red-300":"border-gray-300"}`})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fine ore silenziose"}),e.jsx("input",{type:"time",value:x.notification_frequency?.quiet_hours_end||"07:00",onChange:s=>f("notification_frequency.quiet_hours_end",s.target.value),disabled:!u,className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${h["notification_frequency.quiet_hours"]?"border-red-300":"border-gray-300"}`})]}),e.jsx("div",{className:"md:col-span-2",children:e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:x.notification_frequency?.weekend_notifications||!1,onChange:s=>f("notification_frequency.weekend_notifications",s.target.checked),disabled:!u,className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Ricevi notifiche durante il weekend"})]})})]}),h["notification_frequency.quiet_hours"]&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:h["notification_frequency.quiet_hours"]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 sm:p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(q,{className:"w-5 h-5 text-orange-600"}),e.jsx("h4",{className:"font-medium text-gray-900",children:"Preferenze Allerte"})]}),e.jsx("div",{className:"space-y-3 sm:space-y-4",children:[{key:"critical_alerts_only",label:"Solo allerte critiche",description:"Ricevi notifiche solo per situazioni critiche"},{key:"include_photos",label:"Includi foto",description:"Allega foto di evidenza alle notifiche"},{key:"include_location",label:"Includi posizione",description:"Aggiungi informazioni sulla posizione"},{key:"escalation_enabled",label:"Escalation abilitata",description:"Attiva escalation automatica per allerte non gestite"}].map(({key:s,label:t,description:d})=>e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("input",{type:"checkbox",checked:x.alert_preferences?.[s]||!1,onChange:p=>f(`alert_preferences.${s}`,p.target.checked),disabled:!u,className:"mt-1 rounded border-gray-300 text-orange-600 focus:ring-orange-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-sm font-medium text-gray-900",children:t}),e.jsx("p",{className:"text-sm text-gray-500",children:d})]})]},s))})]}),m.isSuccess&&e.jsx("div",{className:"p-4 bg-green-50 border border-green-200 rounded-md",children:e.jsxs("div",{className:"flex",children:[e.jsx(Q,{className:"w-5 h-5 text-green-400"}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm text-green-800",children:"Preferenze notifiche salvate con successo."})})]})}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx(R,{className:"w-5 h-5 text-blue-600 mt-0.5"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-1",children:"Gestione Notifiche"}),e.jsx("p",{className:"text-sm text-blue-800",children:"Personalizza le tue preferenze di notifica per ricevere solo le informazioni che ti interessano. Le modifiche vengono applicate immediatamente."})]})]})})]})}function ce(){const{isLoading:l,hasRole:g,displayName:n}=E();return l?e.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:e.jsx("div",{children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded mb-6"}),e.jsx("div",{className:"space-y-4",children:[1,2,3,4].map(u=>e.jsx("div",{className:"h-32 bg-gray-200 rounded"},u))})]})})}):g(["admin"])?e.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"w-7 h-7 text-blue-600 sm:w-8 sm:h-8"}),e.jsx("h1",{className:"text-xl font-bold text-gray-900 sm:text-2xl",children:"Impostazioni Sistema"})]})}),e.jsx("p",{className:"text-sm text-gray-600 sm:text-base",children:"Gestisci la configurazione dell'azienda, utenti, compliance HACCP e preferenze."})]}),e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsx(P,{title:"Configurazione Azienda",icon:M,defaultExpanded:!0,className:"bg-white",contentClassName:"px-4 py-6 sm:px-6",children:e.jsx(Z,{})}),e.jsx(P,{title:"Gestione Utenti",icon:$,defaultExpanded:!1,className:"bg-white",contentClassName:"px-4 py-6 sm:px-6",children:e.jsx(ee,{})}),e.jsx(P,{title:"Impostazioni HACCP",icon:k,defaultExpanded:!1,className:"bg-white",contentClassName:"px-4 py-6 sm:px-6",children:e.jsx(se,{})}),e.jsx(P,{title:"Preferenze Notifiche",icon:R,defaultExpanded:!1,className:"bg-white",contentClassName:"px-4 py-6 sm:px-6",children:e.jsx(ae,{})})]}),e.jsx("div",{className:"mt-8 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(k,{className:"w-5 h-5 text-blue-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-1",children:"Sicurezza e Privacy"}),e.jsx("p",{className:"text-sm text-blue-800",children:"Tutte le modifiche vengono registrate nel log di audit per garantire la tracciabilità e la conformità alle normative HACCP."})]})]})})]})}):e.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:e.jsx("div",{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(k,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Accesso Negato"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Solo gli amministratori possono accedere alle impostazioni del sistema."}),e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 max-w-md mx-auto",children:[e.jsxs("p",{className:"text-sm text-red-800",children:[e.jsx("strong",{children:"Ruolo richiesto:"})," Amministratore"]}),e.jsxs("p",{className:"text-sm text-red-800 mt-1",children:[e.jsx("strong",{children:"Il tuo ruolo:"})," ",n||"Non determinato"]})]})]})})})}export{ce as default};
