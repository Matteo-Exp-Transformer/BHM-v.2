import{r as f}from"./react-vendor-Cttizgra.js";import{a as G,u as ee,b as I,j as e}from"./query-vendor-BsnDS19Y.js";import{u as te,s as R,b as X,T as L,c as fe,M as B,g as je,d as Z,e as ve,f as ye,C as K}from"./calendar-features-DOX2NwpL.js";import{B as E,M as Ne,S as V,T as Q,o as $,f as se,e as k,d as z,X as ae,I as we,g as F,W as q,s as ne,b as A,U as re,t as _e,k as Ce}from"./ui-vendor-BFMCvSnM.js";const Se=["temperature-reading","maintenance-task","conservation-point","calendar-event","staff","department","product"],Te=t=>Se.includes(t),Ee=t=>({"temperature-reading":"/api/temperature-readings","maintenance-task":"/api/maintenance-tasks","conservation-point":"/api/conservation-points","calendar-event":"/api/calendar-events",staff:"/api/staff",department:"/api/departments",product:"/api/products"})[t];function Ke(t={}){const{autoSync:m=!0,syncInterval:j=3e4,maxRetries:r=3}=t,v=G(),[i,x]=f.useState({isOnline:typeof navigator<"u"?navigator.onLine:!0,isSyncing:!1,pendingOperations:[],lastSyncTime:null,syncErrors:[]}),l=f.useCallback(p=>{try{localStorage.setItem("haccp_pending_operations",JSON.stringify(p))}catch(w){console.error("Failed to save pending operations:",w)}},[]),u=f.useCallback(async()=>{if(i.isSyncing||i.pendingOperations.length===0||!i.isOnline)return;x(b=>({...b,isSyncing:!0,syncErrors:[]}));const p=await Promise.allSettled(i.pendingOperations.map(b=>o(b,v))),w=[],C=[];p.forEach((b,S)=>{const n=i.pendingOperations[S];if(b.status==="fulfilled"&&b.value)w.push(n.id);else{const y=b.status==="rejected"?b.reason instanceof Error?b.reason.message:String(b.reason):"Unknown error";n.retryCount+1>=n.maxRetries?(C.push({operation:n,error:y}),w.push(n.id)):n.retryCount+=1}}),x(b=>{const S=b.pendingOperations.filter(n=>!w.includes(n.id));return l(S),{...b,pendingOperations:S,syncErrors:C,isSyncing:!1,lastSyncTime:new Date}}),w.length>0&&(v.invalidateQueries({queryKey:["conservation"]}),v.invalidateQueries({queryKey:["calendar"]}),v.invalidateQueries({queryKey:["maintenance"]}))},[v,l,i]),N=f.useCallback(()=>{try{const p=localStorage.getItem("haccp_pending_operations");if(p){const C=JSON.parse(p).filter(b=>Te(b.entity));x(b=>({...b,pendingOperations:C}))}}catch(p){console.error("Failed to load pending operations:",p)}},[]);f.useEffect(()=>{N()},[N]),f.useEffect(()=>{const p=()=>{x(C=>({...C,isOnline:!0})),m&&u()},w=()=>{x(C=>({...C,isOnline:!1}))};return window.addEventListener("online",p),window.addEventListener("offline",w),()=>{window.removeEventListener("online",p),window.removeEventListener("offline",w)}},[m,u]),f.useEffect(()=>{if(!m||!i.isOnline)return;const p=setInterval(()=>{i.pendingOperations.length>0&&u()},j);return()=>clearInterval(p)},[m,i.isOnline,i.pendingOperations.length,j,u]),f.useEffect(()=>{if("serviceWorker"in navigator){const p=w=>{w.data?.type==="SYNC_COMPLETE"&&(x(C=>({...C,lastSyncTime:new Date,isSyncing:!1})),v.invalidateQueries({queryKey:["conservation"]}),v.invalidateQueries({queryKey:["calendar"]}),v.invalidateQueries({queryKey:["maintenance"]}))};return navigator.serviceWorker.addEventListener("message",p),()=>{navigator.serviceWorker.removeEventListener("message",p)}}},[v]);const s=f.useCallback(async(p,w,C,b)=>{const S={id:b||`${w}_${p}_${Date.now()}_${Math.random().toString(36).slice(2,9)}`,type:p,entity:w,data:C,timestamp:Date.now(),retryCount:0,maxRetries:r};return x(n=>{const y=[...n.pendingOperations,S];return l(y),{...n,pendingOperations:y}}),S.id},[r,l]),o=f.useCallback(async(p,w)=>{const C=Ee(p.entity),b=p.data,S=p.type==="CREATE"?C:`${C}/${b?.id??""}`,y=await fetch(S,{method:{CREATE:"POST",UPDATE:"PUT",DELETE:"DELETE"}[p.type],headers:{"Content-Type":"application/json"},body:p.type!=="DELETE"?JSON.stringify(p.data):void 0});if(!y.ok)throw new Error(`HTTP ${y.status}: ${y.statusText}`);return w.invalidateQueries({queryKey:[p.entity]}),!0},[]),g=f.useCallback(p=>o(p,v),[v,o]),a=f.useCallback(async()=>{if(i.isSyncing||i.pendingOperations.length===0||!i.isOnline)return;x(b=>({...b,isSyncing:!0,syncErrors:[]}));const p=await Promise.allSettled(i.pendingOperations.map(b=>g(b))),w=[],C=[];p.forEach((b,S)=>{const n=i.pendingOperations[S];if(b.status==="fulfilled"&&b.value)w.push(n.id);else{const y=b.status==="rejected"?b.reason instanceof Error?b.reason.message:String(b.reason):"Unknown error";n.retryCount+1>=n.maxRetries?(C.push({operation:n,error:y}),w.push(n.id)):n.retryCount+=1}}),x(b=>{const S=b.pendingOperations.filter(n=>!w.includes(n.id));return l(S),{...b,pendingOperations:S,syncErrors:C,isSyncing:!1,lastSyncTime:new Date}}),w.length>0&&(v.invalidateQueries({queryKey:["conservation"]}),v.invalidateQueries({queryKey:["calendar"]}),v.invalidateQueries({queryKey:["maintenance"]}))},[v,l,i,g]);f.useEffect(()=>{if(!m||!i.isOnline)return;const p=setInterval(()=>{i.pendingOperations.length>0&&a()},j);return()=>clearInterval(p)},[m,i.isOnline,i.pendingOperations.length,j,a]);const d=f.useCallback(()=>{x(p=>({...p,syncErrors:[]}))},[]),h=f.useCallback(async p=>{const w=i.pendingOperations.find(C=>C.id===p);w&&(w.retryCount=0,await a())},[i.pendingOperations,a]),_=f.useCallback(p=>{x(w=>{const C=w.pendingOperations.filter(b=>b.id!==p);return l(C),{...w,pendingOperations:C}})},[l]);return{isOnline:i.isOnline,isSyncing:i.isSyncing,pendingOperations:i.pendingOperations,lastSyncTime:i.lastSyncTime,syncErrors:i.syncErrors,queueOperation:s,syncPendingOperations:a,clearSyncErrors:d,retrySyncOperation:h,removeOperation:_,hasPendingOperations:i.pendingOperations.length>0,hasErrors:i.syncErrors.length>0}}function Be(t={}){const{pollInterval:m=3e4,enableConnectionInfo:j=!0,onConnectionChange:r,onSlowConnection:v}=t,[i,x]=f.useState({isOnline:navigator.onLine,isSlowConnection:!1,connectionType:null,effectiveType:null,downlink:null,rtt:null,lastChecked:new Date}),l=f.useCallback(()=>{if(!j)return{};const o=navigator.connection||navigator.mozConnection||navigator.webkitConnection;if(!o)return{};const g=o.effectiveType==="slow-2g"||o.effectiveType==="2g"||o.downlink&&o.downlink<.5;return{connectionType:o.type||null,effectiveType:o.effectiveType||null,downlink:o.downlink||null,rtt:o.rtt||null,isSlowConnection:g}},[j]),u=f.useCallback(()=>{const o=l(),g={isOnline:navigator.onLine,lastChecked:new Date,...o};x(a=>(a.isOnline!==g.isOnline&&r&&r(g.isOnline),a.isSlowConnection!==g.isSlowConnection&&v&&v(g.isSlowConnection||!1),{...a,...g}))},[l,r,v]),N=f.useCallback(async()=>{try{const o=new AbortController,g=setTimeout(()=>o.abort(),5e3),a=await fetch("/favicon.ico?"+Date.now(),{method:"HEAD",cache:"no-cache",signal:o.signal});return clearTimeout(g),a.ok}catch{return!1}},[]),s=f.useCallback(async()=>{const o=await N();return x(g=>({...g,isOnline:o,lastChecked:new Date})),o},[N]);return f.useEffect(()=>{const o=()=>{u(),s()},g=()=>{u()},a=()=>{u()};window.addEventListener("online",o),window.addEventListener("offline",g);const d=navigator.connection||navigator.mozConnection||navigator.webkitConnection;return d&&d.addEventListener("change",a),u(),()=>{window.removeEventListener("online",o),window.removeEventListener("offline",g),d&&d.removeEventListener("change",a)}},[u,s]),f.useEffect(()=>{if(m<=0)return;const o=setInterval(()=>{i.isOnline&&s()},m);return()=>clearInterval(o)},[m,i.isOnline,s]),{isOnline:i.isOnline,isSlowConnection:i.isSlowConnection,connectionType:i.connectionType,effectiveType:i.effectiveType,downlink:i.downlink,rtt:i.rtt,lastChecked:i.lastChecked,checkConnectivity:s,testConnectivity:N,isConnected:i.isOnline,isFastConnection:i.isOnline&&!i.isSlowConnection,connectionQuality:i.isSlowConnection?"poor":i.effectiveType==="4g"?"excellent":i.effectiveType==="3g"?"good":"fair"}}const P={departments:t=>["departments",t],department:t=>["department",t]},ke=()=>{const{userProfile:t}=te(),m=G(),j=t?.company_id,{data:r=[],isLoading:v,error:i,refetch:x}=ee({queryKey:P.departments(j||""),queryFn:async()=>{if(!j)throw new Error("Company ID not found");const{data:a,error:d}=await R.from("departments").select("*").eq("company_id",j).order("name",{ascending:!0});if(d)throw d;return a||[]},enabled:!!j,staleTime:5*60*1e3}),l=I({mutationFn:async a=>{if(!j)throw new Error("Company ID not found");const{data:d,error:h}=await R.from("departments").insert({company_id:j,name:a.name,description:a.description||null,is_active:a.is_active??!0}).select().single();if(h)throw h;return d},onSuccess:a=>{m.setQueryData(P.departments(j||""),(d=[])=>[...d,a]),E.success(`Reparto "${a.name}" creato con successo`)},onError:a=>{console.error("Error creating department:",a),E.error(`Errore nella creazione del reparto: ${a.message}`)}}),u=I({mutationFn:async({id:a,input:d})=>{const{data:h,error:_}=await R.from("departments").update({name:d.name,description:d.description||null,is_active:d.is_active,updated_at:new Date().toISOString()}).eq("id",a).select().single();if(_)throw _;return h},onSuccess:a=>{m.setQueryData(P.departments(j||""),(d=[])=>d.map(h=>h.id===a.id?a:h)),E.success(`Reparto "${a.name}" aggiornato con successo`)},onError:a=>{console.error("Error updating department:",a),E.error(`Errore nell'aggiornamento del reparto: ${a.message}`)}}),N=I({mutationFn:async a=>{const{error:d}=await R.from("departments").delete().eq("id",a);if(d)throw d},onSuccess:(a,d)=>{m.setQueryData(P.departments(j||""),(h=[])=>h.filter(_=>_.id!==d)),E.success("Reparto eliminato con successo")},onError:a=>{console.error("Error deleting department:",a),E.error(`Errore nell'eliminazione del reparto: ${a.message}`)}}),s=I({mutationFn:async({id:a,isActive:d})=>{const{data:h,error:_}=await R.from("departments").update({is_active:d,updated_at:new Date().toISOString()}).eq("id",a).select().single();if(_)throw _;return h},onSuccess:a=>{m.setQueryData(P.departments(j||""),(h=[])=>h.map(_=>_.id===a.id?a:_));const d=a.is_active?"attivato":"disattivato";E.success(`Reparto "${a.name}" ${d} con successo`)},onError:a=>{console.error("Error toggling department status:",a),E.error(`Errore nel cambio stato del reparto: ${a.message}`)}}),o=I({mutationFn:async()=>{if(!j)throw new Error("Company ID not found");const a=[{name:"Bancone",description:"Area di servizio al bancone"},{name:"Sala",description:"Area di servizio ai tavoli"},{name:"Magazzino",description:"Area di stoccaggio prodotti"},{name:"Cucina",description:"Area di preparazione e cottura"}],{data:d,error:h}=await R.from("departments").insert(a.map(_=>({company_id:j,name:_.name,description:_.description,is_active:!0}))).select();if(h)throw h;return d||[]},onSuccess:a=>{m.setQueryData(P.departments(j||""),(d=[])=>[...d,...a]),E.success(`${a.length} reparti predefiniti creati con successo`)},onError:a=>{console.error("Error creating preset departments:",a),E.error(`Errore nella creazione dei reparti predefiniti: ${a.message}`)}}),g={total:r.length,active:r.filter(a=>a.is_active).length,inactive:r.filter(a=>!a.is_active).length};return{departments:r,stats:g,isLoading:v,isCreating:l.isPending,isUpdating:u.isPending,isDeleting:N.isPending,isToggling:s.isPending,isCreatingPresets:o.isPending,error:i,createError:l.error,updateError:u.error,deleteError:N.error,createDepartment:l.mutate,updateDepartment:u.mutate,deleteDepartment:N.mutate,toggleDepartmentStatus:s.mutate,createPresetDepartments:o.mutate,refetch:x,getDepartmentById:a=>r.find(d=>d.id===a),getDepartmentsByStatus:a=>r.filter(d=>d.is_active===a)}};function Oe(t){const m=G(),j=[{id:"1",company_id:"test",conservation_point_id:"1",temperature:4.2,target_temperature:4,tolerance_range_min:2,tolerance_range_max:6,status:"compliant",recorded_by:"user1",recorded_at:new Date(Date.now()-2*60*60*1e3),method:"digital_thermometer",notes:"Lettura regolare",validation_status:"validated",created_at:new Date},{id:"2",company_id:"test",conservation_point_id:"1",temperature:6.5,target_temperature:4,tolerance_range_min:2,tolerance_range_max:6,status:"warning",recorded_by:"user2",recorded_at:new Date(Date.now()-4*60*60*1e3),method:"manual",notes:"Temperatura leggermente alta",validation_status:"flagged",created_at:new Date},{id:"3",company_id:"test",conservation_point_id:"2",temperature:-18.1,target_temperature:-18,tolerance_range_min:-20,tolerance_range_max:-16,status:"compliant",recorded_by:"user1",recorded_at:new Date(Date.now()-1*60*60*1e3),method:"automatic_sensor",notes:"Sensore automatico",validation_status:"validated",created_at:new Date},{id:"4",company_id:"test",conservation_point_id:"3",temperature:8.2,target_temperature:6,tolerance_range_min:4,tolerance_range_max:8,status:"warning",recorded_by:"user3",recorded_at:new Date(Date.now()-30*60*1e3),method:"digital_thermometer",notes:"Vetrina esposta al sole",validation_status:"pending",created_at:new Date},{id:"5",company_id:"test",conservation_point_id:"4",temperature:-32,target_temperature:-35,tolerance_range_min:-40,tolerance_range_max:-30,status:"critical",recorded_by:"user1",recorded_at:new Date(Date.now()-10*60*1e3),method:"manual",notes:"Abbattitore non raggiunge temperatura",validation_status:"flagged",created_at:new Date}],{data:r,isLoading:v,error:i}=ee({queryKey:["temperature-readings",t],queryFn:async()=>(console.log("ðŸ”§ Using mock data for temperature readings"),j),enabled:!0}),x=I({mutationFn:async s=>(console.log("ðŸ”§ Mock saving temperature reading:",s),await new Promise(g=>setTimeout(g,500)),{id:`mock-${Date.now()}`,company_id:"test",recorded_at:new Date,validation_status:"pending",...s}),onSuccess:()=>{m.invalidateQueries({queryKey:["temperature-readings"]}),m.invalidateQueries({queryKey:["conservation-points"]}),E.success("Lettura temperatura registrata")},onError:s=>{console.error("Error creating temperature reading:",s),E.error("Errore nella registrazione della temperatura")}}),l=I({mutationFn:async({id:s,data:o})=>{const{data:g,error:a}=await R.from("temperature_readings").update(o).eq("id",s).select().single();if(a)throw a;return g},onSuccess:()=>{m.invalidateQueries({queryKey:["temperature-readings"]}),E.success("Lettura aggiornata")},onError:s=>{console.error("Error updating temperature reading:",s),E.error("Errore nell'aggiornamento della lettura")}}),u=I({mutationFn:async s=>{const{error:o}=await R.from("temperature_readings").delete().eq("id",s);if(o)throw o},onSuccess:()=>{m.invalidateQueries({queryKey:["temperature-readings"]}),E.success("Lettura eliminata")},onError:s=>{console.error("Error deleting temperature reading:",s),E.error("Errore nell'eliminazione della lettura")}}),N={total:r?.length||0,compliant:r?.filter(s=>s.status==="compliant").length||0,warning:r?.filter(s=>s.status==="warning").length||0,critical:r?.filter(s=>s.status==="critical").length||0,byMethod:{manual:r?.filter(s=>s.method==="manual").length||0,digital_thermometer:r?.filter(s=>s.method==="digital_thermometer").length||0,automatic_sensor:r?.filter(s=>s.method==="automatic_sensor").length||0},byValidation:{pending:r?.filter(s=>s.validation_status==="pending").length||0,validated:r?.filter(s=>s.validation_status==="validated").length||0,flagged:r?.filter(s=>s.validation_status==="flagged").length||0}};return{temperatureReadings:r||[],isLoading:v,error:i,stats:N,createReading:x.mutate,updateReading:l.mutate,deleteReading:u.mutate,isCreating:x.isPending,isUpdating:l.isPending,isDeleting:u.isPending}}function De({point:t,onEdit:m,onDelete:j}){const[r,v]=f.useState(!1),i=X[t.status]||X.normal,x=L[t.type]||L.ambient,l=()=>{switch(t.type){case"ambient":return"ðŸŒ¡ï¸";case"fridge":return"â„ï¸";case"freezer":return"ðŸ§Š";case"blast":return"âš¡";default:return"ðŸ“¦"}},u=()=>{switch(t.type){case"ambient":return"Ambiente";case"fridge":return"Frigorifero";case"freezer":return"Freezer";case"blast":return"Abbattitore";default:return"Non definito"}},N=()=>{switch(t.status){case"normal":return e.jsx(z,{className:"w-5 h-5 text-green-600"});case"warning":return e.jsx(k,{className:"w-5 h-5 text-yellow-600"});case"critical":return e.jsx(k,{className:"w-5 h-5 text-red-600"})}},s=()=>{switch(t.status){case"normal":return"Regolare";case"warning":return"Attenzione";case"critical":return"Critico"}};return e.jsxs("div",{className:`rounded-lg border-2 ${i.border} ${i.bg} p-4 transition-all duration-200 hover:shadow-md`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"text-2xl",children:l()}),e.jsxs("div",{children:[e.jsx("h3",{className:`font-semibold ${i.text}`,children:t.name}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[e.jsx(Ne,{className:"w-4 h-4"}),e.jsx("span",{children:t.department?.name||"Reparto non assegnato"}),e.jsx("span",{className:"mx-1",children:"â€¢"}),e.jsx("span",{children:u()})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[N(),e.jsx("button",{onClick:()=>m(t),className:"p-1 text-gray-600 hover:text-blue-600 transition-colors",children:e.jsx(V,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>j(t.id),className:"p-1 text-gray-600 hover:text-red-600 transition-colors",children:e.jsx(Q,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($,{className:`w-4 h-4 ${i.text}`}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Temperatura target"}),e.jsxs("div",{className:`font-semibold ${i.text}`,children:[t.setpoint_temp,"Â°C"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${t.status==="normal"?"bg-green-400":t.status==="warning"?"bg-yellow-400":"bg-red-400"}`}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Stato"}),e.jsx("div",{className:`font-semibold ${i.text}`,children:s()})]})]})]}),t.last_temperature_reading&&e.jsx("div",{className:`rounded-md ${i.bg} border ${i.border} p-3 mb-3`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Ultima lettura"}),e.jsxs("div",{className:`font-semibold ${i.text}`,children:[t.last_temperature_reading.temperature,"Â°C"]})]}),e.jsx("div",{className:"text-xs text-gray-500",children:new Date(t.last_temperature_reading.recorded_at).toLocaleDateString("it-IT",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})})]})}),t.maintenance_due&&e.jsxs("div",{className:"flex items-center space-x-2 text-sm",children:[e.jsx(se,{className:"w-4 h-4 text-gray-600"}),e.jsxs("span",{className:"text-gray-600",children:["Prossima manutenzione:"," ",new Date(t.maintenance_due).toLocaleDateString("it-IT")]})]}),t.product_categories&&t.product_categories.length>0&&e.jsxs("div",{className:"mt-3",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"Categorie prodotti:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:t.product_categories.map((o,g)=>e.jsx("span",{className:"px-2 py-1 bg-white bg-opacity-50 rounded text-xs font-medium",children:o},g))})]}),e.jsx("button",{onClick:()=>v(!r),className:"mt-3 text-sm text-blue-600 hover:text-blue-800 transition-colors",children:r?"Nascondi dettagli":"Mostra dettagli"}),r&&e.jsxs("div",{className:"mt-3 p-3 bg-white bg-opacity-50 rounded border space-y-2",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("strong",{children:"Range di temperatura:"})," ",x.min,"Â°C -"," ",x.max,"Â°C"]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("strong",{children:"Temperatura ottimale:"})," ",x.optimal,"Â°C"]}),t.is_blast_chiller&&e.jsx("div",{className:"text-sm text-blue-600",children:e.jsx("strong",{children:"âš¡ Abbattitore attivo"})}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Creato il"," ",new Date(t.created_at).toLocaleDateString("it-IT",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})]})]})]})}const ze=["Carni fresche","Carni trasformate","Pesce fresco","Pesce trasformato","Latticini","Uova","Verdure fresche","Verdure trasformate","Frutta fresca","Frutta trasformata","Prodotti da forno","Bevande","Condimenti","Conserve","Surgelati","Gelati","Prodotti secchi","Altri"];function Re({task:t,index:m,staff:j,onUpdate:r,onRemove:v}){const[i,x]=f.useState(!0),l=(s,o)=>{r(m,{...t,[s]:o})},N=B[t.type]||{label:"Altro",icon:"tool",color:"gray",defaultDuration:60,defaultChecklist:[]};return e.jsxs("div",{className:"border border-gray-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"button",onClick:()=>x(!i),className:"text-gray-400 hover:text-gray-600",children:i?"â–¼":"â–¶"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:t.title}),e.jsxs("p",{className:"text-sm text-gray-500",children:[N.label," â€¢ ",t.frequency," â€¢ ",t.estimated_duration,"min"]})]})]}),e.jsx("button",{type:"button",onClick:()=>v(m),className:"text-red-500 hover:text-red-700",children:e.jsx(Q,{className:"w-4 h-4"})})]}),i&&e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Titolo *"}),e.jsx("input",{type:"text",value:t.title,onChange:s=>l("title",s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Nome della manutenzione"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo *"}),e.jsx("select",{value:t.type,onChange:s=>l("type",s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:Object.entries(B).map(([s,o])=>e.jsx("option",{value:s,children:o.label},s))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Frequenza *"}),e.jsxs("select",{value:t.frequency,onChange:s=>l("frequency",s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"daily",children:"Giornaliera"}),e.jsx("option",{value:"weekly",children:"Settimanale"}),e.jsx("option",{value:"monthly",children:"Mensile"}),e.jsx("option",{value:"quarterly",children:"Trimestrale"}),e.jsx("option",{value:"annually",children:"Annuale"}),e.jsx("option",{value:"custom",children:"Personalizzata"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Durata (min) *"}),e.jsx("input",{type:"number",min:"5",step:"5",value:t.estimated_duration,onChange:s=>l("estimated_duration",parseInt(s.target.value)||30),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"PrioritÃ  *"}),e.jsxs("select",{value:t.priority,onChange:s=>l("priority",s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"low",children:"Bassa"}),e.jsx("option",{value:"medium",children:"Media"}),e.jsx("option",{value:"high",children:"Alta"}),e.jsx("option",{value:"critical",children:"Critica"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Assegnato a"}),e.jsxs("select",{value:t.assigned_to||"",onChange:s=>l("assigned_to",s.target.value||void 0),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Assegnazione automatica"}),j.map(s=>e.jsxs("option",{value:s.id,children:[s.name," (",s.role,")"]},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Prima scadenza *"}),e.jsx("input",{type:"datetime-local",value:t.next_due.toISOString().slice(0,16),onChange:s=>l("next_due",new Date(s.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx("button",{type:"button",onClick:()=>l("instructions",N.defaultChecklist),className:"text-xs px-2 py-1 bg-blue-100 text-blue-700 rounded hover:bg-blue-200",children:"Carica checklist standard"})})]})]})}function Ie({isOpen:t,onClose:m,onSave:j,point:r,isLoading:v}){const{departments:i}=ke(),{staff:x}=fe(),[l,u]=f.useState({name:"",department_id:"",setpoint_temp:4,is_blast_chiller:!1,product_categories:[],maintenance_due:""}),[N,s]=f.useState([]),[o,g]=f.useState("fridge"),[a,d]=f.useState(!1);f.useEffect(()=>{r?(u({name:r.name,department_id:r.department_id||"",setpoint_temp:r.setpoint_temp,is_blast_chiller:r.is_blast_chiller,product_categories:r.product_categories||[],maintenance_due:r.maintenance_due?new Date(r.maintenance_due).toISOString().split("T")[0]:""}),s(r.maintenance_tasks?.map(n=>({id:n.id,title:n.title,type:n.type,frequency:n.frequency,estimated_duration:n.estimated_duration,assigned_to:n.assigned_to,priority:n.priority,next_due:new Date(n.next_due),instructions:n.checklist}))||[])):(u({name:"",department_id:"",setpoint_temp:4,is_blast_chiller:!1,product_categories:[],maintenance_due:""}),s([]))},[r,t]),f.useEffect(()=>{const n=l.setpoint_temp,y=l.is_blast_chiller;let T="fridge";y?T="blast":n>=15&&n<=25?T="ambient":n>=0&&n<=8?T="fridge":n>=-25&&n<=-15&&(T="freezer"),g(T)},[l.setpoint_temp,l.is_blast_chiller]);const h=n=>{n.preventDefault(),j({name:l.name,department_id:l.department_id,setpoint_temp:l.setpoint_temp,type:o,is_blast_chiller:l.is_blast_chiller,product_categories:l.product_categories,maintenance_due:l.maintenance_due?new Date(l.maintenance_due):void 0},N)},_=()=>{const n={title:"Nuova Manutenzione",type:"general_inspection",frequency:"weekly",estimated_duration:30,priority:"medium",next_due:new Date(Date.now()+6048e5),instructions:[]};s([...N,n])},p=(n,y)=>{const T=[...N];T[n]=y,s(T)},w=n=>{s(N.filter((y,T)=>T!==n))},C=n=>{u(y=>({...y,product_categories:y.product_categories.includes(n)?y.product_categories.filter(T=>T!==n):[...y.product_categories,n]}))},b=()=>{const n=L[o]||L.fridge;return{name:{ambient:"Ambiente",fridge:"Frigorifero",freezer:"Freezer",blast:"Abbattitore"}[o]||"Frigorifero",range:`${n.min}Â°C - ${n.max}Â°C`,optimal:`${n.optimal}Â°C`,icon:o==="ambient"?"ðŸŒ¡ï¸":o==="fridge"?"â„ï¸":o==="freezer"?"ðŸ§Š":"âš¡"}};if(!t)return null;const S=b();return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsx("h2",{className:"text-xl font-semibold",children:r?"Modifica Punto di Conservazione":"Nuovo Punto di Conservazione"}),e.jsx("button",{onClick:m,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(ae,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:h,className:"p-6 space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome punto di conservazione *"}),e.jsx("input",{type:"text",required:!0,value:l.name,onChange:n=>u(y=>({...y,name:n.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"es. Frigorifero Cucina 1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Reparto *"}),e.jsxs("select",{required:!0,value:l.department_id,onChange:n=>u(y=>({...y,department_id:n.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Seleziona reparto"}),i.map(n=>e.jsx("option",{value:n.id,children:n.name},n.id))]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Temperatura target (Â°C) *"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($,{className:"w-5 h-5 text-blue-600"}),e.jsx("input",{type:"number",required:!0,step:"0.1",min:"-99",max:"30",value:l.setpoint_temp,onChange:n=>u(y=>({...y,setpoint_temp:parseFloat(n.target.value)})),className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"is_blast_chiller",checked:l.is_blast_chiller,onChange:n=>u(y=>({...y,is_blast_chiller:n.target.checked})),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("label",{htmlFor:"is_blast_chiller",className:"text-sm font-medium text-gray-700",children:"Abbattitore di temperatura"})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(we,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"font-medium text-blue-900",children:"Classificazione automatica"})]}),e.jsx("div",{className:"text-sm text-blue-800",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-lg",children:S.icon}),e.jsxs("span",{children:[e.jsx("strong",{children:S.name})," - Range: ",S.range," - Ottimale: ",S.optimal]})]})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Categorie prodotti conservati"}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{type:"button",onClick:()=>d(!a),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-left focus:outline-none focus:ring-2 focus:ring-blue-500",children:l.product_categories.length===0?"Seleziona categorie prodotti...":`${l.product_categories.length} categorie selezionate`}),a&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-y-auto",children:ze.map(n=>e.jsxs("label",{className:"flex items-center px-3 py-2 hover:bg-gray-50 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:l.product_categories.includes(n),onChange:()=>C(n),className:"mr-2 rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm",children:n})]},n))})]}),l.product_categories.length>0&&e.jsx("div",{className:"mt-2 flex flex-wrap gap-1",children:l.product_categories.map(n=>e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full",children:n},n))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Manutenzioni Programmate"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Configura le manutenzioni per questo punto di conservazione"})]}),e.jsxs("button",{type:"button",onClick:_,className:"flex items-center gap-2 px-3 py-2 text-sm bg-green-600 text-white rounded-md hover:bg-green-700",children:[e.jsx(F,{className:"w-4 h-4"}),"Aggiungi"]})]}),N.length===0?e.jsxs("div",{className:"text-center py-8 border-2 border-dashed border-gray-300 rounded-lg",children:[e.jsx(q,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Nessuna manutenzione configurata"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Aggiungi manutenzioni per automatizzare il controllo"})]}):e.jsx("div",{className:"space-y-4",children:N.map((n,y)=>e.jsx(Re,{task:n,index:y,staff:x,onUpdate:p,onRemove:w},y))})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-6 border-t",children:[e.jsx("button",{type:"button",onClick:m,className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors",children:"Annulla"}),e.jsx("button",{type:"submit",disabled:v,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:v?"Salvando...":r?"Aggiorna":"Crea"})]})]})]})})}const Ae=[{value:"manual",label:"Manuale",icon:"âœï¸"},{value:"digital_thermometer",label:"Termometro Digitale",icon:"ðŸŒ¡ï¸"},{value:"automatic_sensor",label:"Sensore Automatico",icon:"ðŸ“¡"}];function $e({isOpen:t,onClose:m,onSave:j,conservationPoint:r,isLoading:v}){const{user:i}=te(),[x,l]=f.useState({temperature:r.setpoint_temp,method:"digital_thermometer",notes:"",photo_evidence:""}),[u,N]=f.useState("compliant"),o=(()=>{switch(r.type){case"fridge":return{min:r.setpoint_temp-2,max:r.setpoint_temp+2};case"freezer":return{min:r.setpoint_temp-2,max:r.setpoint_temp+2};case"blast":return{min:r.setpoint_temp-5,max:r.setpoint_temp+5};case"ambient":return{min:r.setpoint_temp-3,max:r.setpoint_temp+3};default:return{min:r.setpoint_temp-2,max:r.setpoint_temp+2}}})();f.useEffect(()=>{let h=2;switch(r.type){case"blast":h=5;break;case"ambient":h=3;break}const _=je(x.temperature,r.setpoint_temp,h);N(_==="normal"?"compliant":_)},[x.temperature,r.setpoint_temp,r.type]),f.useEffect(()=>{t&&l({temperature:r.setpoint_temp,method:"digital_thermometer",notes:"",photo_evidence:""})},[t,r.setpoint_temp]);const g=h=>{if(h.preventDefault(),!i?.id){console.error("No user ID available");return}j({conservation_point_id:r.id,temperature:x.temperature,target_temperature:r.setpoint_temp,tolerance_range_min:o.min,tolerance_range_max:o.max,status:u,recorded_by:i.id,method:x.method,notes:x.notes,photo_evidence:x.photo_evidence,created_at:new Date})},a=()=>{switch(u){case"compliant":return{icon:e.jsx(z,{className:"w-5 h-5 text-green-600"}),text:"Conforme",color:"text-green-900",bg:"bg-green-50",border:"border-green-200"};case"warning":return{icon:e.jsx(k,{className:"w-5 h-5 text-yellow-600"}),text:"Attenzione",color:"text-yellow-900",bg:"bg-yellow-50",border:"border-yellow-200"};case"critical":return{icon:e.jsx(k,{className:"w-5 h-5 text-red-600"}),text:"Critico",color:"text-red-900",bg:"bg-red-50",border:"border-red-200"};default:return{icon:e.jsx(z,{className:"w-5 h-5 text-green-600"}),text:"Conforme",color:"text-green-900",bg:"bg-green-50",border:"border-green-200"}}};if(!t)return null;const d=a()||{icon:e.jsx(z,{className:"w-5 h-5 text-green-600"}),text:"Conforme",color:"text-green-900",bg:"bg-green-50",border:"border-green-200"};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg w-full max-w-md max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Registra Temperatura"}),e.jsx("p",{className:"text-sm text-gray-600",children:r.name})]}),e.jsx("button",{onClick:m,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(ae,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:g,className:"p-6 space-y-6",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx($,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"font-medium text-blue-900",children:"Informazioni Punto"})]}),e.jsxs("div",{className:"text-sm text-blue-800 space-y-1",children:[e.jsxs("div",{children:["Temperatura target:"," ",e.jsxs("strong",{children:[r.setpoint_temp,"Â°C"]})]}),e.jsxs("div",{children:["Range tolleranza:"," ",e.jsxs("strong",{children:[o.min,"Â°C - ",o.max,"Â°C"]})]}),e.jsxs("div",{children:["Tipo:"," ",e.jsx("strong",{children:r.type==="fridge"?"Frigorifero":r.type==="freezer"?"Freezer":r.type==="blast"?"Abbattitore":"Ambiente"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Temperatura rilevata (Â°C) *"}),e.jsx("input",{type:"number",required:!0,step:"0.1",value:x.temperature,onChange:h=>l(_=>({..._,temperature:parseFloat(h.target.value)||0})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"es. 4.2"})]}),e.jsxs("div",{className:`rounded-lg border p-4 ${d.bg} ${d.border}`,children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[d.icon,e.jsxs("span",{className:`font-medium ${d.color}`,children:["Stato: ",d.text]})]}),u!=="compliant"&&e.jsx("div",{className:`text-sm mt-1 ${d.color}`,children:u==="warning"?"Temperatura fuori dal range ottimale":"Temperatura in range critico - Azione richiesta"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Metodo di rilevazione *"}),e.jsx("div",{className:"space-y-2",children:Ae.map(h=>e.jsxs("label",{className:"flex items-center space-x-3 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"method",value:h.value,checked:x.method===h.value,onChange:_=>l(p=>({...p,method:_.target.value})),className:"text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-lg",children:h.icon}),e.jsx("span",{className:"text-sm",children:h.label})]},h.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Note aggiuntive"}),e.jsx("textarea",{value:x.notes,onChange:h=>l(_=>({..._,notes:h.target.value})),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Osservazioni, condizioni particolari..."})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[e.jsx(ne,{className:"w-4 h-4 inline mr-1"}),"Foto evidenza (URL)"]}),e.jsx("input",{type:"url",value:x.photo_evidence,onChange:h=>l(_=>({..._,photo_evidence:h.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"https://..."}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Opzionale: URL della foto del termometro o del punto di misurazione"})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-6 border-t",children:[e.jsx("button",{type:"button",onClick:m,className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors",children:"Annulla"}),e.jsx("button",{type:"submit",disabled:v,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:v?"Registrando...":"Registra"})]})]})]})})}function Me({reading:t,onEdit:m,onDelete:j,showActions:r=!0}){const v=()=>{switch(t.status){case"compliant":return{icon:e.jsx(z,{className:"w-4 h-4 text-green-600"}),text:"Conforme",color:"text-green-900",bg:"bg-green-50",border:"border-green-200"};case"warning":return{icon:e.jsx(k,{className:"w-4 h-4 text-yellow-600"}),text:"Attenzione",color:"text-yellow-900",bg:"bg-yellow-50",border:"border-yellow-200"};case"critical":return{icon:e.jsx(k,{className:"w-4 h-4 text-red-600"}),text:"Critico",color:"text-red-900",bg:"bg-red-50",border:"border-red-200"}}},i=()=>{switch(t.method){case"manual":return{icon:"âœï¸",text:"Manuale"};case"digital_thermometer":return{icon:"ðŸŒ¡ï¸",text:"Termometro Digitale"};case"automatic_sensor":return{icon:"ðŸ“¡",text:"Sensore Automatico"};default:return{icon:"â“",text:"Non specificato"}}},x=()=>{if(!t.validation_status)return{icon:e.jsx(A,{className:"w-3 h-3 text-gray-400"}),text:"Non validata",color:"text-gray-400"};switch(t.validation_status){case"validated":return{icon:e.jsx(z,{className:"w-3 h-3 text-green-600"}),text:"Validata",color:"text-green-600"};case"flagged":return{icon:e.jsx(k,{className:"w-3 h-3 text-red-600"}),text:"Segnalata",color:"text-red-600"};case"pending":return{icon:e.jsx(A,{className:"w-3 h-3 text-yellow-600"}),text:"In attesa",color:"text-yellow-600"}}},l=g=>new Date(g).toLocaleDateString("it-IT",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),u=v(),N=i(),s=x(),o=t.temperature<(t.tolerance_range_min??0)||t.temperature>(t.tolerance_range_max??0);return e.jsxs("div",{className:`rounded-lg border-2 p-4 transition-all duration-200 hover:shadow-md ${u.bg} ${u.border}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`p-2 rounded-full ${u.bg}`,children:e.jsx($,{className:`w-5 h-5 ${t.status==="compliant"?"text-green-600":t.status==="warning"?"text-yellow-600":"text-red-600"}`})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:`text-2xl font-bold ${u.color}`,children:[t.temperature,"Â°C"]}),u.icon]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Target: ",t.target_temperature??0,"Â°C"]})]})]}),r&&m&&j&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("button",{onClick:()=>m(t),className:"p-1 text-gray-600 hover:text-blue-600 transition-colors",children:e.jsx(V,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>j(t.id),className:"p-1 text-gray-600 hover:text-red-600 transition-colors",children:e.jsx(Q,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-600",children:"Range tolleranza"}),e.jsxs("div",{className:"text-sm font-medium",children:[t.tolerance_range_min,"Â°C - ",t.tolerance_range_max,"Â°C"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-600",children:"Scostamento"}),e.jsxs("div",{className:`text-sm font-medium ${o?"text-red-600":"text-green-600"}`,children:[t.temperature>(t.target_temperature??0)?"+":"",(t.temperature-(t.target_temperature??0)).toFixed(1),"Â°C"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{className:"w-4 h-4 text-gray-600"}),e.jsx("span",{className:"text-gray-600",children:l(t.recorded_at)})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[s.icon,e.jsx("span",{className:`text-xs ${s.color}`,children:s.text})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-lg",children:N.icon}),e.jsx("span",{className:"text-gray-600",children:N.text})]}),t.photo_evidence&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(ne,{className:"w-4 h-4 text-blue-600"}),e.jsx("a",{href:t.photo_evidence,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-blue-600 hover:text-blue-800",children:"Foto"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm",children:[e.jsx(re,{className:"w-4 h-4 text-gray-600"}),e.jsxs("span",{className:"text-gray-600",children:["Operatore: ",t.recorded_by]})]}),t.notes&&e.jsxs("div",{className:"mt-2 p-2 bg-white bg-opacity-50 rounded text-sm",children:[e.jsx("strong",{children:"Note:"})," ",t.notes]})]}),t.status!=="compliant"&&e.jsx("div",{className:`mt-3 p-2 rounded border ${u.bg} ${u.border}`,children:e.jsxs("div",{className:"flex items-center space-x-2",children:[u.icon,e.jsx("span",{className:`text-sm font-medium ${u.color}`,children:t.status==="warning"?"Attenzione: Temperatura fuori dal range ottimale":"Critico: Intervento richiesto immediatamente"})]})})]})}function Pe({task:t,status:m,onComplete:j,onEdit:r,onDelete:v,showActions:i=!0}){const x=B[t.type],l=Z[m]||Z.scheduled,u=d=>new Date(d).toLocaleDateString("it-IT",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"}),N=()=>{switch(t.frequency){case"daily":return"Giornaliera";case"weekly":return"Settimanale";case"monthly":return"Mensile";case"custom":return"Personalizzata";default:return t.frequency}},s=()=>{switch(m){case"overdue":return e.jsx(k,{className:"w-5 h-5 text-red-600"});case"pending":return e.jsx(A,{className:"w-5 h-5 text-yellow-600"});case"scheduled":return e.jsx(se,{className:"w-5 h-5 text-green-600"})}},o=()=>{switch(m){case"overdue":return"In Ritardo";case"pending":return"Urgente";case"scheduled":return"Programmata"}},g=m==="overdue",a=m==="pending";return e.jsxs("div",{className:`rounded-lg border-2 p-4 transition-all duration-200 hover:shadow-md ${l.bg} ${l.border}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"text-2xl",children:x.icon}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:x.label}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[e.jsxs("span",{children:["Frequenza: ",N()]}),e.jsx("span",{className:"mx-1",children:"â€¢"}),e.jsxs("span",{children:[t.estimated_duration," min"]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[s(),i&&e.jsxs("div",{className:"flex items-center space-x-1",children:[!g&&e.jsx("button",{onClick:()=>j(t),className:"p-1 text-gray-600 hover:text-green-600 transition-colors",title:"Completa manutenzione",children:e.jsx(z,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>r(t),className:"p-1 text-gray-600 hover:text-blue-600 transition-colors",title:"Modifica task",children:e.jsx(V,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>v(t.id),className:"p-1 text-gray-600 hover:text-red-600 transition-colors",title:"Elimina task",children:e.jsx(Q,{className:"w-4 h-4"})})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-600",children:"Stato"}),e.jsxs("div",{className:`font-semibold flex items-center space-x-1 ${l.text}`,children:[s(),e.jsx("span",{children:o()})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-600",children:"Prossima scadenza"}),e.jsx("div",{className:`font-semibold ${g||a?"text-red-600":"text-gray-900"}`,children:u(t.next_due)})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm mb-3",children:[e.jsx(re,{className:"w-4 h-4 text-gray-600"}),e.jsxs("span",{className:"text-gray-600",children:["Assegnato a: ",e.jsx("strong",{children:t.assigned_to||"Non assegnato"})]}),t.assigned_to&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"mx-1 text-gray-400",children:"â€¢"}),e.jsx("span",{className:"text-gray-500 capitalize",children:t.assigned_to})]})]}),t.checklist&&t.checklist.length>0&&e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"text-sm font-medium text-gray-700 mb-2",children:["Checklist (",t.checklist.length," elementi):"]}),e.jsxs("div",{className:"space-y-1",children:[t.checklist.slice(0,3).map((d,h)=>e.jsxs("div",{className:"flex items-start space-x-2 text-sm",children:[e.jsx("div",{className:"w-4 h-4 mt-0.5 rounded border border-gray-300 flex-shrink-0"}),e.jsx("span",{className:"text-gray-600 line-clamp-1",children:d})]},h)),t.checklist.length>3&&e.jsxs("div",{className:"text-xs text-gray-500 pl-6",children:["+",t.checklist.length-3," altri elementi..."]})]})]}),(g||a)&&e.jsx("div",{className:`mt-3 p-2 rounded border ${g?"bg-red-50 border-red-200":"bg-yellow-50 border-yellow-200"}`,children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(k,{className:`w-4 h-4 ${g?"text-red-600":"text-yellow-600"}`}),e.jsx("span",{className:`text-sm font-medium ${g?"text-red-800":"text-yellow-800"}`,children:g?"Manutenzione in ritardo - Intervento immediato richiesto":"Manutenzione urgente - Scadenza imminente"})]})}),g&&e.jsxs("button",{onClick:()=>j(t),className:"w-full mt-3 flex items-center justify-center space-x-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:[e.jsx(_e,{className:"w-4 h-4"}),e.jsx("span",{children:"Completa Ora"})]})]})}function qe(){const{conservationPoints:t,stats:m,isLoading:j,createConservationPoint:r,updateConservationPoint:v,deleteConservationPoint:i,isCreating:x,isUpdating:l,isDeleting:u}=ve(),[N,s]=f.useState(!1),[o,g]=f.useState(null),[a,d]=f.useState(!1),[h,_]=f.useState(null),[,p]=f.useState(null),{temperatureReadings:w,stats:C,isLoading:b,createReading:S,deleteReading:n,isCreating:y}=Oe(),{maintenanceTasks:T,stats:O,isLoading:ie,getTaskStatus:U,deleteTask:le,completeTask:oe}=ye(),ce=(c,D=[])=>{o?v({id:o.id,data:c}):r({conservationPoint:c,maintenanceTasks:D}),s(!1),g(null)},de=c=>{g(c),s(!0)},me=c=>{confirm("Sei sicuro di voler eliminare questo punto di conservazione?")&&i(c)},W=()=>{g(null),s(!0)},Y=c=>{_(c),d(!0)},ue=c=>{S(c),d(!1),_(null)},xe=c=>{p(c),alert("Modifica lettura temperatura - FunzionalitÃ  in arrivo")},ge=c=>{confirm("Sei sicuro di voler eliminare questa lettura di temperatura?")&&n(c)},pe=c=>{confirm(`Sei sicuro di voler completare la manutenzione "${c.type}" per ${c.conservation_point?.name}?`)&&oe({maintenance_task_id:c.id,completed_by:"user1",completed_at:new Date,created_at:new Date,notes:"Completato tramite interfaccia web"})},he=c=>{alert("Modifica manutenzione - FunzionalitÃ  in arrivo")},be=c=>{confirm("Sei sicuro di voler eliminare questo task di manutenzione?")&&le(c)};return j?e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[1,2,3].map(c=>e.jsx("div",{className:"h-24 bg-gray-200 rounded"},c))}),e.jsx("div",{className:"h-64 bg-gray-200 rounded"})]})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Sistema di Conservazione"}),e.jsx("p",{className:"text-gray-600",children:"Gestisci punti di conservazione e monitoraggio temperature"})]})}),e.jsxs("div",{className:"bg-white rounded-lg border p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center",children:[e.jsx(Ce,{className:"w-5 h-5 mr-2 text-blue-600"}),"Distribuzione per Tipo"]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2 md:grid-cols-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl mb-1",children:"ðŸŒ¡ï¸"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Ambiente"}),e.jsx("div",{className:"text-lg font-semibold",children:m.by_type.ambient??0})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl mb-1",children:"â„ï¸"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Frigorifero"}),e.jsx("div",{className:"text-lg font-semibold",children:m.by_type.fridge??0})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl mb-1",children:"ðŸ§Š"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Freezer"}),e.jsx("div",{className:"text-lg font-semibold",children:m.by_type.freezer??0})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl mb-1",children:"âš¡"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Abbattitore"}),e.jsx("div",{className:"text-lg font-semibold",children:m.by_type.blast??0})]})]})]}),e.jsxs(K,{title:"Punti di Conservazione",subtitle:`${m.total_points} punti configurati`,defaultExpanded:!0,icon:$,actions:e.jsxs("button",{onClick:c=>{c.stopPropagation(),W()},className:"flex items-center space-x-1 px-3 py-1 text-sm bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:[e.jsx(F,{className:"w-4 h-4"}),e.jsx("span",{children:"Aggiungi"})]}),children:[e.jsxs("div",{className:"mb-6 grid grid-cols-1 gap-3 sm:grid-cols-2 md:grid-cols-4",children:[e.jsx("div",{className:"bg-blue-50 rounded-lg border border-blue-200 p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-blue-700",children:"Frigoriferi"}),e.jsx("p",{className:"text-lg font-bold text-blue-900",children:m.by_type.fridge??0})]}),e.jsx("div",{className:"text-xl",children:"â„ï¸"})]})}),e.jsx("div",{className:"bg-cyan-50 rounded-lg border border-cyan-200 p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-cyan-700",children:"Freezer"}),e.jsx("p",{className:"text-lg font-bold text-cyan-900",children:m.by_type.freezer??0})]}),e.jsx("div",{className:"text-xl",children:"ðŸ§Š"})]})}),e.jsx("div",{className:"bg-purple-50 rounded-lg border border-purple-200 p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-purple-700",children:"Abbattitore"}),e.jsx("p",{className:"text-lg font-bold text-purple-900",children:m.by_type.blast??0})]}),e.jsx("div",{className:"text-xl",children:"âš¡"})]})}),e.jsx("div",{className:"bg-orange-50 rounded-lg border border-orange-200 p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-orange-700",children:"Dispensa"}),e.jsx("p",{className:"text-lg font-bold text-orange-900",children:m.by_type.ambient??0})]}),e.jsx("div",{className:"text-xl",children:"ðŸŒ¡ï¸"})]})})]}),t.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx($,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Nessun punto di conservazione"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Inizia creando il primo punto di conservazione per il monitoraggio delle temperature."}),e.jsxs("button",{onClick:W,className:"flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors mx-auto",children:[e.jsx(F,{className:"w-5 h-5"}),e.jsx("span",{children:"Crea Primo Punto"})]})]}):e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:t.map(c=>e.jsx(De,{point:c,onEdit:de,onDelete:me},c.id))})]}),e.jsxs(K,{title:"Letture Temperature",subtitle:`${C.total} letture registrate`,defaultExpanded:!0,icon:A,actions:e.jsx("div",{className:"flex items-center space-x-2",children:t.length>0&&e.jsxs("select",{onChange:c=>{const D=t.find(M=>M.id===c.target.value);D&&(Y(D),c.target.value="")},onClick:c=>{c.stopPropagation()},onMouseDown:c=>{c.stopPropagation()},value:"",className:"flex items-center space-x-1 px-3 py-1 text-sm bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:[e.jsx("option",{value:"",children:"Registra temperatura..."}),t.map(c=>e.jsx("option",{value:c.id,children:c.name},c.id))]})}),children:[e.jsxs("div",{className:"mb-6 grid grid-cols-1 gap-3 sm:grid-cols-2 md:grid-cols-4",children:[e.jsx("div",{className:"bg-blue-50 rounded-lg border border-blue-200 p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-blue-700",children:"Totale"}),e.jsx("p",{className:"text-lg font-bold text-blue-900",children:C.total})]}),e.jsx(A,{className:"w-5 h-5 text-blue-600"})]})}),e.jsx("div",{className:"bg-green-50 rounded-lg border border-green-200 p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-green-700",children:"Conformi"}),e.jsx("p",{className:"text-lg font-bold text-green-900",children:C.compliant})]}),e.jsx(z,{className:"w-5 h-5 text-green-600"})]})}),e.jsx("div",{className:"bg-yellow-50 rounded-lg border border-yellow-200 p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-yellow-700",children:"Attenzione"}),e.jsx("p",{className:"text-lg font-bold text-yellow-900",children:C.warning})]}),e.jsx(k,{className:"w-5 h-5 text-yellow-600"})]})}),e.jsx("div",{className:"bg-red-50 rounded-lg border border-red-200 p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-red-700",children:"Critiche"}),e.jsx("p",{className:"text-lg font-bold text-red-900",children:C.critical})]}),e.jsx(k,{className:"w-5 h-5 text-red-600"})]})})]}),b?e.jsx("div",{className:"animate-pulse space-y-4",children:[1,2,3].map(c=>e.jsx("div",{className:"h-32 bg-gray-200 rounded"},c))}):w.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(A,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Nessuna lettura di temperatura"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Inizia registrando la prima lettura di temperatura per un punto di conservazione."}),t.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Seleziona un punto di conservazione:"}),e.jsx("div",{className:"flex flex-wrap gap-2 justify-center",children:t.map(c=>e.jsxs("button",{onClick:()=>Y(c),className:"flex items-center space-x-2 px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx($,{className:"w-4 h-4"}),e.jsx("span",{children:c.name})]},c.id))})]})]}):e.jsx("div",{className:"space-y-4",children:w.sort((c,D)=>new Date(D.recorded_at).getTime()-new Date(c.recorded_at).getTime()).map(c=>e.jsx(Me,{reading:c,onEdit:xe,onDelete:ge},c.id))})]}),e.jsxs(K,{title:"Manutenzioni Programmate",subtitle:`${O.total_tasks} task configurati`,defaultExpanded:!0,icon:q,actions:e.jsxs("button",{onClick:c=>{c.stopPropagation(),alert("Aggiungi manutenzione - FunzionalitÃ  in arrivo")},className:"flex items-center space-x-1 px-3 py-1 text-sm bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:[e.jsx(F,{className:"w-4 h-4"}),e.jsx("span",{children:"Aggiungi"})]}),children:[e.jsxs("div",{className:"mb-6 grid grid-cols-1 gap-3 sm:grid-cols-2 md:grid-cols-4",children:[e.jsx("div",{className:"bg-blue-50 rounded-lg border border-blue-200 p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-blue-700",children:"Totale"}),e.jsx("p",{className:"text-lg font-bold text-blue-900",children:O.total_tasks})]}),e.jsx(q,{className:"w-5 h-5 text-blue-600"})]})}),e.jsx("div",{className:"bg-red-50 rounded-lg border border-red-200 p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-red-700",children:"In Ritardo"}),e.jsx("p",{className:"text-lg font-bold text-red-900",children:O.overdue_tasks})]}),e.jsx(k,{className:"w-5 h-5 text-red-600"})]})}),e.jsx("div",{className:"bg-yellow-50 rounded-lg border border-yellow-200 p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-yellow-700",children:"Urgenti"}),e.jsx("p",{className:"text-lg font-bold text-yellow-900",children:Math.max(O.total_tasks-O.overdue_tasks,0)})]}),e.jsx(A,{className:"w-5 h-5 text-yellow-600"})]})}),e.jsx("div",{className:"bg-green-50 rounded-lg border border-green-200 p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-green-700",children:"Programmate"}),e.jsx("p",{className:"text-lg font-bold text-green-900",children:O.completed_tasks})]}),e.jsx(z,{className:"w-5 h-5 text-green-600"})]})})]}),e.jsxs("div",{className:"mb-6 bg-gray-50 rounded-lg p-4",children:[e.jsxs("h4",{className:"text-sm font-semibold mb-3 flex items-center text-gray-700",children:[e.jsx(q,{className:"w-4 h-4 mr-2 text-blue-600"}),"Distribuzione per Tipo"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg mb-1",children:"ðŸŒ¡ï¸"}),e.jsx("div",{className:"text-xs text-gray-600",children:"Controllo Temperature"}),e.jsx("div",{className:"text-sm font-semibold",children:O.tasks_by_type.temperature_calibration??0})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg mb-1",children:"ðŸ§¼"}),e.jsx("div",{className:"text-xs text-gray-600",children:"Pulizia Profonda"}),e.jsx("div",{className:"text-sm font-semibold",children:O.tasks_by_type.deep_cleaning??0})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg mb-1",children:"â„ï¸"}),e.jsx("div",{className:"text-xs text-gray-600",children:"Sbrinamento"}),e.jsx("div",{className:"text-sm font-semibold",children:O.tasks_by_type.defrosting??0})]})]})]}),ie?e.jsx("div",{className:"animate-pulse space-y-4",children:[1,2,3].map(c=>e.jsx("div",{className:"h-32 bg-gray-200 rounded"},c))}):T.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(q,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Nessuna manutenzione programmata"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Le manutenzioni vengono create automaticamente per ogni punto di conservazione."})]}):e.jsx("div",{className:"space-y-4",children:T.sort((c,D)=>{const M={overdue:0,pending:1,scheduled:2},H=U(c),J=U(D);return M[H]!==M[J]?M[H]-M[J]:new Date(c.next_due).getTime()-new Date(D.next_due).getTime()}).map(c=>e.jsx(Pe,{task:c,status:U(c),onComplete:pe,onEdit:he,onDelete:be},c.id))})]}),e.jsx(Ie,{isOpen:N,onClose:()=>{s(!1),g(null)},onSave:ce,point:o,isLoading:x||l}),h&&e.jsx($e,{isOpen:a,onClose:()=>{d(!1),_(null)},onSave:ue,conservationPoint:h,isLoading:y}),u&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25 flex items-center justify-center z-40",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 flex items-center space-x-3",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"}),e.jsx("span",{children:"Eliminando..."})]})})]})}const Ge=Object.freeze(Object.defineProperty({__proto__:null,default:qe},Symbol.toStringTag,{value:"Module"}));export{Ge as C,Ke as a,Be as b,ke as u};
